<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚è³¼ç‰©ä»˜æ¬¾ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
            background-color: #f0f9ff;
        }

        /* åƒ¹éŒ¢ç‰Œæ¨£å¼ */
        .price-tag {
            background-image: linear-gradient(135deg, #fde68a 0%, #fca5a5 100%);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: rotate(-2deg);
            transition: transform 0.3s ease;
        }
        .price-tag:hover {
            transform: rotate(0deg) scale(1.05);
        }

        /* ç¡¬å¹£èˆ‡ç´™å¹£é€šç”¨æŒ‰éˆ•æ¨£å¼ */
        .money-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            position: relative;
            background-color: white;
            flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
        }
        .money-btn:active {
            transform: scale(0.95);
        }
        .money-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* ç¡¬å¹£ç‰¹å®šæ¨£å¼ */
        .coin-style {
            border-radius: 50%;
        }

        /* ç´™å¹£ç‰¹å®šæ¨£å¼ */
        .note-style {
            border-radius: 4px;
            /* ç´™å¹£é•·å¯¬æ¯”ç´„ç‚º 2:1 */
        }

        /* ç­”æ¡ˆå€ç¡¬å¹£ç§»é™¤å‹•ç•« */
        .coin-remove {
            animation: popOut 0.3s forwards;
        }
        @keyframes popOut {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* é€²åº¦æ¢éæ¸¡å‹•ç•« */
        .progress-bar-fill {
            transition: width 0.3s ease-out, background-color 0.3s ease;
        }

        /* å‹åˆ©å½ˆçª—å‹•ç•« */
        .modal-enter {
            animation: modalPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* æ»¾å‹•æ¢ç¾åŒ– */
        .hide-scrollbar::-webkit-scrollbar {
            height: 6px;
        }
        .hide-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
        .hide-scrollbar::-webkit-scrollbar-track {
            background-color: transparent;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden select-none">

    <!-- é ‚éƒ¨æ¨™é¡Œèˆ‡æ§åˆ¶å€ -->
    <header class="bg-white p-3 shadow-sm flex justify-between items-center z-10 gap-2">
        <div class="flex items-center gap-2 overflow-hidden">
            <h1 class="text-lg md:text-xl font-bold text-slate-700 whitespace-nowrap">ğŸ›’ ä»˜æ¬¾ç·´ç¿’</h1>
            <!-- æ¨¡å¼é¸æ“‡ -->
            <select id="game-mode" onchange="changeMode()" class="text-sm border border-blue-300 rounded-lg px-2 py-1 bg-blue-50 text-blue-700 font-bold focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="small">$20å…ƒå…§ (ç¡¬å¹£)</option>
                <option value="large">$10000å…ƒå…§ (ç´™å¹£+ç¡¬å¹£)</option>
            </select>
        </div>
        <button onclick="initGame()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-bold transition shadow whitespace-nowrap">
            ä¸‹ä¸€é¡Œ
        </button>
    </header>

    <!-- ä¸»éŠæˆ²å€åŸŸ -->
    <main class="flex-1 flex flex-col p-2 md:p-4 max-w-5xl mx-auto w-full gap-2 md:gap-4 overflow-hidden">
        
        <!-- 1. åƒ¹éŒ¢ç‰Œå€ -->
        <section class="flex justify-center items-center py-2 md:py-4 min-h-[100px] md:min-h-[120px]">
            <div class="price-tag border-4 border-white px-8 py-6 md:px-12 md:py-8 rounded-xl text-center relative min-w-[220px]">
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gray-300 rounded-full border-2 border-gray-400"></div>
                <p class="text-gray-600 text-sm font-bold mb-1">è«‹æ”¯ä»˜</p>
                <div class="text-5xl md:text-6xl font-black text-slate-800 tracking-wider" id="target-price">$0.00</div>
            </div>
        </section>

        <!-- 2. é€²åº¦å€ -->
        <section class="bg-white p-3 md:p-4 rounded-xl shadow-sm shrink-0">
            <div class="flex justify-between text-sm font-bold text-gray-500 mb-2">
                <span>ç›®å‰é‡‘é¡: <span id="current-display" class="text-blue-600 text-lg">$0.00</span></span>
                <span id="status-text">é‚„å·®ä¸€é»é»...</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-6 md:h-8 border border-gray-300 overflow-hidden relative">
                <div class="absolute right-0 top-0 bottom-0 w-1 bg-red-300 z-10" title="ç›®æ¨™é‡‘é¡"></div> 
                <div id="progress-bar" class="progress-bar-fill bg-blue-500 h-full rounded-full w-0 relative">
                    <div class="absolute inset-0 bg-white opacity-20" style="background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent); background-size: 1rem 1rem;"></div>
                </div>
            </div>
        </section>

        <!-- 3. ç­”æ¡ˆå€ -->
        <section class="flex-1 bg-slate-100 rounded-xl border-2 border-dashed border-slate-300 p-2 relative flex flex-col overflow-hidden">
            <div class="absolute top-0 left-0 bg-slate-200 text-slate-500 text-xs px-2 py-1 rounded-br-lg z-10">
                é»æ“Šåœ–æ¡ˆå¯å–å›
            </div>
            <div id="answer-zone" class="flex-1 overflow-y-auto p-4 flex flex-wrap content-start justify-center gap-2 md:gap-3">
                <div class="text-gray-400 text-sm mt-10 w-full text-center pointer-events-none" id="empty-hint">
                    è«‹å¾ä¸‹æ–¹é¸æ“‡éŒ¢å¹£æˆ–ç´™å¹£
                </div>
            </div>
        </section>

        <!-- 4. é¸æ“‡å€ (å‹•æ…‹ç”Ÿæˆ) -->
        <section class="bg-white rounded-t-2xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-2 pb-6 md:p-4 md:pb-8 z-20 shrink-0">
            <div class="text-center text-gray-400 text-xs mb-2 font-bold">é»æ“Šä»˜æ¬¾</div>
            <div id="coin-palette" class="flex flex-col gap-3">
                <!-- é€™è£¡æœƒç”± JS æ ¹æ“šæ¨¡å¼ç”Ÿæˆä¸€è¡Œæˆ–å…©è¡Œ -->
            </div>
        </section>

    </main>

    <!-- å‹åˆ©å½ˆçª— -->
    <div id="win-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-3xl p-8 max-w-sm w-11/12 text-center shadow-2xl border-4 border-yellow-400 modal-enter">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h2 class="text-3xl font-black text-slate-800 mb-2">ä»˜æ¬¾æˆåŠŸï¼</h2>
            <p class="text-gray-600 mb-6">ä½ çš„æ•¸å­¸çœŸæ£’ï¼å‰›å¥½æ˜¯ <span id="win-price" class="font-bold text-green-600"></span></p>
            <button onclick="initGame()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-3 px-6 rounded-xl shadow-lg transform transition active:scale-95 text-xl">
                ä¸‹ä¸€é¡Œ âœ
            </button>
        </div>
    </div>

    <script>
        // --- è³‡æ–™è¨­å®š ---
        
        // ç´™å¹£è³‡æ–™ (æ³¨æ„åœ–ç‰‡ä¾†æºçš„å¯é æ€§ï¼ŒåŠ å…¥ onerror fallback)
        const NOTES = [
            { val: 100000, img: 'https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd1000-back.png', label: '1000å…ƒ', type: 'note' },
            { val: 50000, img: 'https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd500-back.png', label: '500å…ƒ', type: 'note' },
            { val: 10000, img: 'https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd100-back.png', label: '100å…ƒ', type: 'note' },
            { val: 5000, img: 'https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd50-back.png', label: '50å…ƒ', type: 'note' },
            { val: 2000, img: 'https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd20-back.png', label: '20å…ƒ', type: 'note' },
            { val: 1000, img: 'https://upload.wikimedia.org/wikipedia/zh/b/b0/HKSAR_hkd10_2007_f.jpg', label: '10å…ƒ', type: 'note' }
        ];

        // ç¡¬å¹£è³‡æ–™ (ä¿®æ­£é€£çµèˆ‡ç·¨ç¢¼)
        const COINS = [
            { val: 1000, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/10%E5%85%83%E6%AD%A3%E9%9D%A2.png', label: '10å…ƒ', type: 'coin' },
            { val: 500, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/5%E5%85%83%E6%AD%A3%E9%9D%A2.png', label: '5å…ƒ', type: 'coin' },
            { val: 200, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/2%E5%85%83%E6%AD%A3%E9%9D%A2.png', label: '2å…ƒ', type: 'coin' },
            { val: 100, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/1%E5%85%83%E6%AD%A3%E9%9D%A2.png', label: '1å…ƒ', type: 'coin' },
            { val: 50, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/5%E8%A7%92%E6%AD%A3%E9%9D%A2.png', label: '5è§’', type: 'coin' },
            { val: 20, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/2%E8%A7%92%E6%AD%A3%E9%9D%A2.png', label: '2è§’', type: 'coin' },
            { val: 10, img: 'https://raw.githubusercontent.com/margaret0209/mathgame/main/1%E8%A7%92%E6%AD%A3%E9%9D%A2.png', label: '1è§’', type: 'coin' }
        ];

        // --- éŠæˆ²ç‹€æ…‹ ---
        let currentMode = 'small'; // 'small' or 'large'
        let targetAmount = 0; // åˆ†
        let currentAmount = 0; // åˆ†
        let selectedCoins = [];

        // --- DOM å…ƒç´  ---
        const targetPriceEl = document.getElementById('target-price');
        const currentDisplayEl = document.getElementById('current-display');
        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');
        const answerZone = document.getElementById('answer-zone');
        const coinPalette = document.getElementById('coin-palette');
        let emptyHint = document.getElementById('empty-hint');
        const winModal = document.getElementById('win-modal');
        const winPriceEl = document.getElementById('win-price');
        const modeSelect = document.getElementById('game-mode');

        // --- åŠŸèƒ½å‡½æ•¸ ---

        function changeMode() {
            currentMode = modeSelect.value;
            initGame();
        }

        function initGame() {
            // é‡ç½®
            currentAmount = 0;
            selectedCoins = [];
            winModal.classList.add('hidden');

            // ç”Ÿæˆç›®æ¨™é‡‘é¡
            if (currentMode === 'small') {
                // $20å…ƒä»¥å…§ (0.10 - 20.00)
                const randomSteps = Math.floor(Math.random() * 200) + 1; 
                targetAmount = randomSteps * 10;
            } else {
                // $10000å…ƒä»¥å…§ï¼Œä¿ç•™å°æ•¸é»è®ŠåŒ– (0.10 - 10000.00)
                // å¤§éƒ¨åˆ†æ™‚å€™æˆ‘å€‘å¸Œæœ›æœ‰æ•´æ•¸ç´™å¹£åƒèˆ‡ï¼Œä½†ä¹Ÿéœ€è¦å°æ•¸é»
                const maxVal = 10000 * 100; // 1,000,000 åˆ†
                // ç‚ºäº†è®“é¡Œç›®æ›´æœ‰è¶£ï¼Œéš¨æ©Ÿç”¢ç”Ÿä¸€å€‹æ•¸å€¼ï¼Œæ­¥é•·ç‚º10åˆ†
                const randomSteps = Math.floor(Math.random() * 100000) + 1;
                targetAmount = randomSteps * 10;
            }

            renderUI();
            renderSelectionZone();
        }

        function formatMoney(cents) {
            // åŠ ä¸Šåƒä½åˆ†éš”ç¬¦
            let val = (cents / 100).toFixed(2);
            // ç°¡å–®æ­£å‰‡åŠ ä¸Šé€—è™Ÿ (ä¾‹å¦‚ 1,234.50)
            return '$' + val.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // æ¸²æŸ“é¸æ“‡å€
        function renderSelectionZone() {
            coinPalette.innerHTML = '';

            if (currentMode === 'large') {
                // ç¬¬ä¸€è¡Œï¼šç´™å¹£
                const notesRow = document.createElement('div');
                notesRow.className = 'flex justify-center items-center gap-2 md:gap-4 overflow-x-auto hide-scrollbar w-full py-1';
                
                NOTES.forEach(note => {
                    const btn = createMoneyButton(note, 'w-24 h-12 md:w-32 md:h-16', 'note-style');
                    notesRow.appendChild(btn);
                });
                coinPalette.appendChild(notesRow);

                // ç¬¬äºŒè¡Œï¼šç¡¬å¹£
                const coinsRow = document.createElement('div');
                coinsRow.className = 'flex justify-center items-center gap-2 md:gap-4 overflow-x-auto hide-scrollbar w-full py-1 border-t border-slate-100 pt-3';
                
                COINS.forEach(coin => {
                    // ç¡¬å¹£åœ¨ç´™å¹£æ¨¡å¼ä¸‹å¤§å°å¯ä»¥ç¨å°ä¸€é»ä»¥é©é…ç•«é¢
                    const btn = createMoneyButton(coin, 'w-12 h-12 md:w-16 md:h-16', 'coin-style');
                    coinsRow.appendChild(btn);
                });
                coinPalette.appendChild(coinsRow);

            } else {
                // $20æ¨¡å¼ï¼šåŸæœ¬çš„å–®è¡Œç¡¬å¹£
                const row = document.createElement('div');
                row.className = 'flex justify-center items-end gap-3 md:gap-6 overflow-x-auto hide-scrollbar w-full py-2';
                
                COINS.forEach(coin => {
                    // å¤§ä¸€é»çš„ç¡¬å¹£
                    const sizeClass = coin.val >= 500 ? 'w-16 h-16 md:w-20 md:h-20' : 'w-14 h-14 md:w-16 md:h-16';
                    const btn = createMoneyButton(coin, sizeClass, 'coin-style');
                    row.appendChild(btn);
                });
                coinPalette.appendChild(row);
            }
        }

        // å»ºç«‹å–®å€‹é‡‘éŒ¢æŒ‰éˆ•çš„é€šç”¨å‡½æ•¸
        function createMoneyButton(data, sizeClass, styleClass) {
            const btn = document.createElement('div');
            // èƒŒæ™¯è‰²å¾®èª¿
            const bgClass = data.type === 'note' ? 'bg-blue-50 border-blue-200' : 'bg-yellow-50 border-yellow-200';
            
            btn.className = `money-btn ${sizeClass} ${styleClass} flex items-center justify-center border ${bgClass}`;
            
            // åœ–ç‰‡èˆ‡ Fallback
            btn.innerHTML = `
                <img src="${data.img}" 
                     alt="${data.label}" 
                     class="w-full h-full object-contain pointer-events-none drop-shadow-sm ${styleClass === 'note-style' ? 'rounded-sm' : ''}"
                     onerror="this.style.display='none'; this.parentElement.innerText='${data.label}'; this.parentElement.classList.add('font-bold', 'text-slate-600', 'text-xs', 'md:text-sm')">
            `;
            
            btn.onclick = () => addMoney(data);
            return btn;
        }

        // å¢åŠ é‡‘é¡
        function addMoney(moneyData) {
            const moneyId = Date.now() + Math.random();
            selectedCoins.push({ ...moneyData, id: moneyId });
            currentAmount += moneyData.val;

            // æ¸²æŸ“åˆ°ç­”æ¡ˆå€
            const el = document.createElement('div');
            el.id = `money-${moneyId}`;
            
            // æ ¹æ“šé¡å‹æ±ºå®šé¡¯ç¤ºå¤§å°
            let displaySize = '';
            let shapeClass = '';
            if (moneyData.type === 'note') {
                displaySize = 'w-20 h-10 md:w-24 md:h-12';
                shapeClass = 'rounded shadow-sm';
            } else {
                displaySize = 'w-12 h-12 md:w-14 md:h-14';
                shapeClass = 'rounded-full';
            }

            el.className = `${displaySize} money-btn animate-[bounce_0.3s] flex items-center justify-center bg-white border border-gray-200 ${shapeClass}`;
            
            el.innerHTML = `
                <img src="${moneyData.img}" 
                     class="w-full h-full object-contain pointer-events-none drop-shadow-sm"
                     onerror="this.style.display='none'; this.parentElement.innerText='${moneyData.label}'; this.parentElement.classList.add('font-bold', 'text-slate-600', 'text-xs')">
            `;
            el.onclick = () => removeMoney(moneyId, moneyData.val);

            answerZone.appendChild(el);
            answerZone.scrollTop = answerZone.scrollHeight;

            updateGameState();
        }

        // ç§»é™¤é‡‘é¡
        function removeMoney(id, val) {
            const el = document.getElementById(`money-${id}`);
            if (el) {
                el.classList.add('coin-remove');
                setTimeout(() => {
                    el.remove();
                    if (answerZone.children.length <= 1) {
                         emptyHint.style.display = 'block';
                    }
                }, 250);
            }
            currentAmount -= val;
            selectedCoins = selectedCoins.filter(c => c.id !== id);
            updateGameState();
        }

        // æ›´æ–°ç‹€æ…‹
        function updateGameState() {
            if (selectedCoins.length > 0) {
                emptyHint.style.display = 'none';
            } else {
                emptyHint.style.display = 'block';
            }

            targetPriceEl.textContent = formatMoney(targetAmount);
            currentDisplayEl.textContent = formatMoney(currentAmount);

            // è¨ˆç®—é€²åº¦ç™¾åˆ†æ¯”
            // æ³¨æ„ï¼šè‹¥ targetAmount ç‚º 0 (æ¥µç«¯æƒ…æ³) éœ€è™•ç†
            const percentage = targetAmount > 0 ? Math.min((currentAmount / targetAmount) * 100, 100) : 0;
            progressBar.style.width = `${percentage}%`;

            if (currentAmount < targetAmount) {
                progressBar.className = 'progress-bar-fill bg-blue-500 h-full rounded-full relative';
                statusText.textContent = 'é‚„å·®ä¸€é»...';
                statusText.className = 'text-blue-500 font-bold';
                currentDisplayEl.className = 'text-blue-600 text-lg font-bold';
            } else if (currentAmount === targetAmount) {
                progressBar.className = 'progress-bar-fill bg-green-500 h-full rounded-full relative';
                statusText.textContent = 'å‰›å¥½ï¼';
                statusText.className = 'text-green-600 font-bold';
                currentDisplayEl.className = 'text-green-600 text-lg font-bold';
                setTimeout(triggerWin, 300);
            } else {
                progressBar.className = 'progress-bar-fill bg-red-500 h-full rounded-full relative';
                statusText.textContent = 'å¤ªå¤šäº†ï¼';
                statusText.className = 'text-red-500 font-bold';
                currentDisplayEl.className = 'text-red-600 text-lg font-bold';
            }
        }

        function triggerWin() {
            winPriceEl.textContent = formatMoney(targetAmount);
            winModal.classList.remove('hidden');
        }

        function renderUI() {
            targetPriceEl.textContent = formatMoney(targetAmount);
            currentDisplayEl.textContent = "$0.00";
            progressBar.style.width = "0%";
            answerZone.innerHTML = '<div class="text-gray-400 text-sm mt-10 w-full text-center pointer-events-none" id="empty-hint">è«‹å¾ä¸‹æ–¹é¸æ“‡éŒ¢å¹£æˆ–ç´™å¹£</div>';
            emptyHint = document.getElementById('empty-hint');
            statusText.textContent = 'è«‹é–‹å§‹é¸æ“‡';
            statusText.className = 'text-gray-500';
            progressBar.className = 'progress-bar-fill bg-blue-500 h-full rounded-full relative';
        }

        // åˆå§‹åŒ–
        initGame();

    </script>
</body>
</html>