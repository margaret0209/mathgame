<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´™å¹£ç¸½å€¼äº’å‹•éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­—å¹²æ“¾éŠæˆ²é«”é©— */
        }

        .banknote-img {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
            width: 100%; /* è®“åœ–ç‰‡å¡«æ»¿ç¶²æ ¼å–®å…ƒ */
            height: auto;
        }

        .banknote-img:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        /* æç¤ºæ°£æ³¡æ¨£å¼ä¿®æ­£ï¼šèƒŒæ™¯ç¸®å°è‡³è²¼åˆæ–‡å­— */
        .hint-bubble {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 2rem; /* æ”¾å¤§å­—é«” */
            font-weight: 800;
            color: #16a34a; /* ç¶ è‰²æ–‡å­— (Tailwind green-600) */
            background-color: rgba(255, 255, 255, 0.95); /* ç™½è‰²èƒŒæ™¯ */
            padding: 0.1em 0.4em; /* ç¸®å°å…§è·ä»¥è²¼åˆæ–‡å­— */
            border-radius: 9999px; /* åœ“è§’æ•ˆæœ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15); /* å¢åŠ é™°å½±ä½¿å…¶æµ®èµ· */
            border: 2px solid #dcfce7; /* è¼•å¾®çš„ç¶ è‰²é‚Šæ¡†è®“å°æ¯”æ›´å¥½ */
            
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            pointer-events: none;
            white-space: nowrap;
            line-height: 1.1; /* ç¢ºä¿è¡Œé«˜ç·Šæ¹Š */
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .keypad-btn {
            transition: background-color 0.1s, transform 0.1s;
        }
        .keypad-btn:active {
            transform: scale(0.95);
        }

        /* é–ƒçˆå‹•ç•« */
        @keyframes flash-green {
            0% { background-color: #dcfce7; }
            50% { background-color: #86efac; }
            100% { background-color: #dcfce7; }
        }
        .bg-flash-success {
            animation: flash-green 1s infinite;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- é ‚éƒ¨æ¨¡å¼é¸æ“‡ -->
    <header class="bg-white shadow-md p-2 z-10 relative">
        <div class="max-w-7xl mx-auto relative flex flex-col items-center">
            <h1 class="text-xl md:text-2xl font-bold text-center text-blue-800 mb-2 w-full">ç´™å¹£ç¸½å€¼å¤§æŒ‘æˆ°</h1>
            
            <!-- å³ä¸Šè§’éš¨æ©Ÿæ¨¡å¼æŒ‰éˆ• -->
            <button id="random-btn" onclick="toggleRandomMode()" class="absolute right-0 top-0 mt-1 mr-2 px-3 py-1 rounded shadow text-sm font-bold transition-all bg-gray-200 text-gray-600 hover:bg-gray-300">
                <i class="fas fa-random mr-1"></i> éš¨æ©Ÿæ¨¡å¼ï¼šé—œ
            </button>

            <div class="flex flex-wrap justify-center gap-2" id="mode-buttons">
                <!-- æŒ‰éˆ•ç”± JS ç”Ÿæˆ -->
            </div>
        </div>
    </header>

    <!-- éŠæˆ²ä¸»å€åŸŸ -->
    <main class="flex-1 flex flex-col md:flex-row h-full overflow-hidden">
        
        <!-- å·¦æ–¹ï¼šé¡Œç›®é¡¯ç¤ºå€ -->
        <div class="w-full md:w-2/3 bg-blue-50 p-4 flex flex-col relative border-b md:border-b-0 md:border-r border-blue-200">
            
            <!-- ä¸Šæ–¹è³‡è¨Šæ¬„ï¼šé€²åº¦èˆ‡æç¤º -->
            <div class="flex justify-between items-center mb-4 px-2">
                <div class="bg-white px-4 py-2 rounded-full shadow text-blue-600 font-bold text-lg whitespace-nowrap">
                    é¡Œç›®ï¼š<span id="progress-display">1 / 10</span>
                </div>
                <div id="instruction-text" class="text-lg text-gray-700 font-bold text-center flex-1 mx-4">
                    éš¨æ™‚é»æ“Šç´™å¹£å‡ºç¾æç¤º
                </div>
            </div>

            <!-- ç´™å¹£å±•ç¤ºå®¹å™¨ (å¯æ»¾å‹•) -->
            <div class="flex-1 overflow-y-auto flex justify-center items-start">
                <!-- ä½¿ç”¨ grid-cols-5 å¼·åˆ¶ä¸€è¡Œäº”å¼µ -->
                <div id="banknotes-area" class="grid grid-cols-5 gap-4 w-full max-w-4xl p-2 auto-rows-min">
                    <!-- ç´™å¹£åœ–ç‰‡å°‡åœ¨æ­¤ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ä¸‹ä¸€é¡ŒæŒ‰éˆ•å€åŸŸ (å›ºå®šåœ¨åº•éƒ¨) -->
            <div id="next-btn-area" class="hidden w-full p-4 flex flex-col items-center justify-center bg-blue-50/90 backdrop-blur-sm absolute bottom-0 left-0 z-30 border-t border-blue-200">
                <!-- æ–°å¢ï¼šç­”æ¡ˆå¥å­é¡¯ç¤º -->
                <div id="result-sentence" class="text-xl md:text-3xl font-bold text-blue-900 mb-3 bg-white px-6 py-2 rounded-xl shadow-sm border-2 border-blue-100 transform transition-all animate-bounce-in">
                    <!-- å…§å®¹ç”± JS ç”Ÿæˆ -->
                </div>
                
                <button onclick="nextQuestion()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-12 rounded-full text-2xl shadow-lg transform transition hover:scale-105 flex items-center gap-2">
                    ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- å³æ–¹ï¼šè¼¸å…¥æ§åˆ¶å€ -->
        <div class="w-full md:w-1/3 bg-white p-4 flex flex-col items-center justify-center shadow-lg z-20">
            
            <!-- é¡¯ç¤ºè¢å¹• -->
            <div class="w-full max-w-xs mb-6">
                <div id="display-container" class="bg-gray-100 border-4 border-blue-200 rounded-xl h-20 flex items-center justify-end px-4 shadow-inner transition-colors duration-300">
                    <span class="text-gray-400 text-2xl mr-2">$</span>
                    <span id="input-display" class="text-4xl font-mono text-gray-800 tracking-widest"></span>
                    <span class="animate-pulse text-blue-500 text-4xl ml-1">|</span>
                </div>
                <div id="feedback-msg" class="text-center h-8 mt-2 font-bold text-lg"></div>
            </div>

            <!-- æ•¸å­—éµç›¤ -->
            <div class="grid grid-cols-3 gap-3 w-full max-w-xs">
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('1')">1</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('2')">2</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('3')">3</button>
                
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('4')">4</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('5')">5</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('6')">6</button>
                
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('7')">7</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('8')">8</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('9')">9</button>
                
                <button class="keypad-btn bg-red-100 hover:bg-red-200 text-red-600 text-xl font-bold py-4 rounded-lg shadow" onclick="deleteNumber()">åˆªé™¤</button>
                <button class="keypad-btn bg-blue-100 hover:bg-blue-200 text-blue-800 text-2xl font-bold py-4 rounded-lg shadow" onclick="appendNumber('0')">0</button>
                <button id="confirm-btn" class="keypad-btn bg-green-500 hover:bg-green-600 text-white text-xl font-bold py-4 rounded-lg shadow" onclick="checkAnswer()">ç¢ºå®š</button>
            </div>
        </div>
    </main>

    <!-- å®Œæˆç•«é¢ (éš±è—) -->
    <div id="completion-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-md mx-4 animate-bounce-in">
            <div class="text-6xl mb-4">ğŸ†</div>
            <h2 class="text-3xl font-bold text-blue-800 mb-4">æ­å–œå®Œæˆï¼</h2>
            <p class="text-gray-600 mb-6 text-lg">ä½ å·²ç¶“å®Œæˆäº†æ‰€æœ‰é¡Œç›®ï¼</p>
            <button onclick="resetGame()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg transition transform hover:scale-105">
                å†ç©ä¸€æ¬¡
            </button>
        </div>
    </div>

    <script>
        // éŠæˆ²é…ç½®æ•¸æ“š
        const CONFIG = {
            modes: [10, 20, 50, 100, 500, 1000],
            images: {
                10: "https://upload.wikimedia.org/wikipedia/zh/b/b0/HKSAR_hkd10_2007_f.jpg",
                20: "https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd20-back.png",
                50: "https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd50-back.png",
                100: "https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd100-back.png",
                500: "https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd500-back.png",
                1000: "https://www.bochk.com/dam/bochk/desktop/top/aboutus/banknote/2018/img/bochk_hkd1000-back.png"
            }
        };

        // éŠæˆ²ç‹€æ…‹
        let currentState = {
            mode: 10,
            isRandomMode: false,
            questionQueue: [], // å­˜å„²é¡Œç›®çš„ç´™å¹£æ•¸é‡åºåˆ— (0-9 ä»£è¡¨ 1-10å¼µ)
            currentQueueIndex: 0, // ç•¶å‰åœ¨ queue ä¸­çš„ä½ç½®
            currentInput: "",
            hintsRevealed: [], 
            nextHintIndex: 0,
            isAnswerCorrect: false
        };

        // åˆå§‹åŒ–
        function init() {
            renderModeButtons();
            startGame(10);
        }

        // åˆ‡æ›éš¨æ©Ÿæ¨¡å¼
        function toggleRandomMode() {
            currentState.isRandomMode = !currentState.isRandomMode;
            
            const btn = document.getElementById('random-btn');
            if (currentState.isRandomMode) {
                btn.innerHTML = '<i class="fas fa-random mr-1"></i> éš¨æ©Ÿæ¨¡å¼ï¼šé–‹';
                btn.classList.remove('bg-gray-200', 'text-gray-600');
                btn.classList.add('bg-purple-600', 'text-white', 'hover:bg-purple-700');
            } else {
                btn.innerHTML = '<i class="fas fa-random mr-1"></i> éš¨æ©Ÿæ¨¡å¼ï¼šé—œ';
                btn.classList.add('bg-gray-200', 'text-gray-600');
                btn.classList.remove('bg-purple-600', 'text-white', 'hover:bg-purple-700');
            }

            // åˆ‡æ›æ¨¡å¼å¾Œé‡æ–°é–‹å§‹
            startGame(currentState.mode);
        }

        // ç”Ÿæˆé¡Œç›®åºåˆ—
        function generateQueue() {
            if (currentState.isRandomMode) {
                // éš¨æ©Ÿé¸3é¡Œ
                let allQuestions = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
                // æ´—ç‰Œç®—æ³•
                for (let i = allQuestions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
                }
                // å–å‰3å€‹ä¸¦æ’åº (ç”±å°‘åˆ°å¤šï¼Œè®“æ•™å­¸æ›´é †æš¢ï¼Œä¹Ÿå¯ç§»é™¤ sort è®Šç´”éš¨æ©Ÿ)
                // é€™è£¡ä¿ç•™ sort è®“é›£åº¦å¾ªåºæ¼¸é€²ï¼Œå¦‚æœæƒ³è¦å®Œå…¨éš¨æ©Ÿé †åºè«‹ç§»é™¤ .sort(...)
                return allQuestions.slice(0, 3).sort((a, b) => a - b);
            } else {
                // ä¸€èˆ¬æ¨¡å¼ï¼šå›ºå®š 1 åˆ° 10
                return [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
            }
        }

        // æ¸²æŸ“æ¨¡å¼æŒ‰éˆ•
        function renderModeButtons() {
            const container = document.getElementById('mode-buttons');
            container.innerHTML = '';
            CONFIG.modes.forEach(mode => {
                const btn = document.createElement('button');
                btn.className = `px-4 py-1 rounded-full border-2 font-bold text-sm md:text-base transition-colors duration-200
                    ${currentState.mode === mode ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-blue-600 border-blue-300 hover:bg-blue-50'}`;
                btn.innerText = `$${mode}`;
                btn.onclick = () => startGame(mode);
                btn.id = `mode-btn-${mode}`;
                container.appendChild(btn);
            });
        }

        function updateModeButtons() {
            CONFIG.modes.forEach(mode => {
                const btn = document.getElementById(`mode-btn-${mode}`);
                if (currentState.mode === mode) {
                    btn.className = 'px-4 py-1 rounded-full border-2 font-bold text-sm md:text-base transition-colors duration-200 bg-blue-600 text-white border-blue-600 shadow-md transform scale-105';
                } else {
                    btn.className = 'px-4 py-1 rounded-full border-2 font-bold text-sm md:text-base transition-colors duration-200 bg-white text-blue-600 border-blue-300 hover:bg-blue-50';
                }
            });
        }

        function startGame(mode) {
            currentState.mode = mode;
            currentState.questionQueue = generateQueue(); // ç”Ÿæˆæ–°é¡Œç›®
            currentState.currentQueueIndex = 0;
            
            updateModeButtons();
            document.getElementById('completion-modal').classList.add('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            // å¾ queue ç²å–ç•¶å‰é¡Œç›®çš„ç´™å¹£æ•¸é‡ç´¢å¼•
            const noteIndex = currentState.questionQueue[currentState.currentQueueIndex];
            const count = noteIndex + 1;
            
            // é‡ç½®ç‹€æ…‹
            currentState.currentInput = "";
            currentState.nextHintIndex = 0;
            currentState.hintsRevealed = new Array(count).fill(false);
            currentState.isAnswerCorrect = false;

            // UI é‡ç½®
            // é¡¯ç¤ºé¡Œç›®é€²åº¦ (ä¾‹å¦‚ 1 / 3 æˆ– 1 / 10)
            const totalQs = currentState.questionQueue.length;
            document.getElementById('progress-display').innerText = `${currentState.currentQueueIndex + 1} / ${totalQs}`;
            
            document.getElementById('input-display').innerText = "";
            document.getElementById('feedback-msg').innerText = "";
            document.getElementById('feedback-msg').className = "text-center h-8 mt-2 font-bold text-lg";
            document.getElementById('instruction-text').innerText = "é»æ“Šç´™å¹£å¯é¡¯ç¤ºé‡‘é¡æç¤º";
            document.getElementById('instruction-text').className = "text-lg text-gray-700 font-bold text-center flex-1 mx-4";
            
            document.getElementById('next-btn-area').classList.add('hidden');
            document.getElementById('display-container').classList.remove('bg-green-100', 'border-green-400', 'bg-flash-success');
            document.getElementById('display-container').classList.add('bg-gray-100', 'border-blue-200');

            renderBanknotes(count);
        }

        function renderBanknotes(count) {
            const container = document.getElementById('banknotes-area');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = "relative group w-full"; 
                
                const img = document.createElement('img');
                img.src = CONFIG.images[currentState.mode];
                img.className = `banknote-img rounded shadow-sm border border-gray-200`;
                img.alt = `${currentState.mode}å…ƒç´™å¹£`;
                
                // ä»»ä½•æ™‚å€™éƒ½å¯ä»¥é»æ“Š
                wrapper.onclick = () => handleNoteClick(i, wrapper);

                wrapper.appendChild(img);
                container.appendChild(wrapper);
            }
        }

        function handleNoteClick(index, wrapperElement) {
            // ä¿æŒç”±å·¦è‡³å³çš„é‚è¼¯ï¼Œé¿å…è·³è™Ÿ
            if (index !== currentState.nextHintIndex) return;

            // å¦‚æœå·²ç¶“é¡¯ç¤ºï¼Œä¸å†é‡è¤‡
            if (currentState.hintsRevealed[index]) return;

            const cumulativeValue = (index + 1) * currentState.mode;
            
            const bubble = document.createElement('div');
            // ä¿®æ”¹å¾Œçš„æ¨£å¼ï¼šå±…ä¸­ã€æ”¾å¤§
            bubble.className = "hint-bubble";
            bubble.innerText = cumulativeValue;
            
            wrapperElement.appendChild(bubble);
            currentState.hintsRevealed[index] = true;
            currentState.nextHintIndex++;
        }

        function appendNumber(num) {
            if (currentState.isAnswerCorrect) return; // ç­”å°é–å®šè¼¸å…¥
            if (currentState.currentInput.length < 6) {
                currentState.currentInput += num;
                document.getElementById('input-display').innerText = currentState.currentInput;
            }
        }

        function deleteNumber() {
            if (currentState.isAnswerCorrect) return;
            currentState.currentInput = currentState.currentInput.slice(0, -1);
            document.getElementById('input-display').innerText = currentState.currentInput;
        }

        function checkAnswer() {
            if (currentState.isAnswerCorrect) return;
            if (currentState.currentInput === "") return;

            const inputVal = parseInt(currentState.currentInput);
            
            // è¨ˆç®—æ­£ç¢ºç­”æ¡ˆ (éœ€æ ¹æ“š queue è£¡çš„çœŸå¯¦æ•¸é‡)
            const noteIndex = currentState.questionQueue[currentState.currentQueueIndex];
            const count = noteIndex + 1;
            const correctVal = (noteIndex + 1) * currentState.mode;
            
            const feedbackEl = document.getElementById('feedback-msg');
            const displayContainer = document.getElementById('display-container');

            if (inputVal === correctVal) {
                // ç­”å°
                currentState.isAnswerCorrect = true;
                feedbackEl.innerText = "ç­”å°äº†ï¼ğŸ‘";
                feedbackEl.className = "text-center h-8 mt-2 font-bold text-lg text-green-600";
                
                // è¦–è¦ºå›é¥‹
                displayContainer.classList.remove('bg-gray-100', 'border-blue-200');
                displayContainer.classList.add('bg-green-100', 'border-green-400', 'bg-flash-success');

                // ç”Ÿæˆä¸¦é¡¯ç¤ºç­”æ¡ˆå¥å­
                const resultSentence = `${count}å¼µ${currentState.mode}å…ƒçš„ç¸½å€¼ç‚º${correctVal}å…ƒ`;
                document.getElementById('result-sentence').innerText = resultSentence;

                // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•å€åŸŸ
                document.getElementById('next-btn-area').classList.remove('hidden');

            } else {
                // ç­”éŒ¯
                feedbackEl.innerText = "å†è©¦ä¸€æ¬¡ï¼";
                feedbackEl.className = "text-center h-8 mt-2 font-bold text-lg text-red-500 animate-pulse";
                
                // æ¸…ç©ºè¼¸å…¥
                currentState.currentInput = "";
                document.getElementById('input-display').innerText = "";
            }
        }

        // åˆ‡æ›ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            // æª¢æŸ¥æ˜¯å¦é‚„æœ‰ä¸‹ä¸€é¡Œ
            if (currentState.currentQueueIndex < currentState.questionQueue.length - 1) {
                currentState.currentQueueIndex++;
                loadQuestion();
            } else {
                showCompletion();
            }
        }

        function showCompletion() {
            document.getElementById('completion-modal').classList.remove('hidden');
        }

        function resetGame() {
            startGame(currentState.mode);
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>
