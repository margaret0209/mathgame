<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‘å­¸å°æ•™å®¤ï¼šæ··åˆç‰©èˆ‡åˆ†é›¢</title>
    <!-- å¼•å…¥ Tailwind CSS é€²è¡Œå¿«é€Ÿæ¨£å¼è¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
            user-select: none; /* é˜²æ­¢å­¸ç”Ÿæ„å¤–é¸å–æ–‡å­— */
        }

        /* è‡ªå®šç¾©å‹•ç•«é¡åˆ¥ */
        .bounce-slow {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-10%); }
            50% { transform: translateY(0); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .drop-animation {
            animation: dropDown 2s forwards;
        }

        @keyframes dropDown {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(150px); opacity: 0; }
        }

        .steam-animation {
            animation: riseUp 3s forwards;
        }

        @keyframes riseUp {
            0% { transform: translateY(0) scale(1); opacity: 0.8; }
            100% { transform: translateY(-100px) scale(2); opacity: 0; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æŒ‰éˆ•äº’å‹•æ•ˆæœ */
        .interactive-btn {
            transition: transform 0.1s, background-color 0.2s;
        }
        .interactive-btn:active {
            transform: scale(0.95);
        }

        /* éŠæˆ²å€åŸŸ */
        .game-option {
            cursor: pointer;
            transition: all 0.3s;
        }
        .game-option:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <!-- é ‚éƒ¨å°èˆªæ¬„ -->
    <header class="bg-blue-500 p-4 shadow-lg z-10">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold text-white flex items-center gap-2">
                ğŸ§ª ç§‘å­¸å°æ•™å®¤
            </h1>
            <div class="text-white text-lg font-bold bg-blue-600 px-4 py-2 rounded-full hidden md:block">
                æ··åˆç‰©èˆ‡åˆ†é›¢
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="flex-1 overflow-y-auto p-4 relative bg-sky-50" id="main-content">
        <!-- é€™è£¡æ˜¯å‹•æ…‹å…§å®¹åŠ è¼‰å€ -->
        <div class="max-w-3xl mx-auto h-full flex flex-col justify-center items-center text-center fade-in" id="scene-container">
            <!-- åˆå§‹åŠ è¼‰ä¸­... -->
        </div>
    </main>

    <!-- åº•éƒ¨å°èˆªæ¬„ (å¤§æŒ‰éˆ•é©åˆæ“ä½œ) -->
    <nav class="bg-white p-2 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-20">
        <div class="max-w-4xl mx-auto grid grid-cols-4 gap-2">
            <button onclick="navigate('intro')" class="nav-btn bg-yellow-100 hover:bg-yellow-200 text-yellow-800 p-2 rounded-xl flex flex-col items-center justify-center transition-colors border-b-4 border-yellow-300 active:border-b-0 active:mt-1">
                <span class="text-2xl">ğŸ¥£</span>
                <span class="text-xs md:text-sm font-bold">ä»€éº¼æ˜¯æ··åˆç‰©</span>
            </button>
            <button onclick="navigate('examples')" class="nav-btn bg-green-100 hover:bg-green-200 text-green-800 p-2 rounded-xl flex flex-col items-center justify-center transition-colors border-b-4 border-green-300 active:border-b-0 active:mt-1">
                <span class="text-2xl">ğŸ </span>
                <span class="text-xs md:text-sm font-bold">ç”Ÿæ´»ä¾‹å­</span>
            </button>
            <button onclick="navigate('methods')" class="nav-btn bg-blue-100 hover:bg-blue-200 text-blue-800 p-2 rounded-xl flex flex-col items-center justify-center transition-colors border-b-4 border-blue-300 active:border-b-0 active:mt-1">
                <span class="text-2xl">ğŸ”¬</span>
                <span class="text-xs md:text-sm font-bold">åˆ†é›¢æ–¹æ³•</span>
            </button>
            <button onclick="navigate('game')" class="nav-btn bg-purple-100 hover:bg-purple-200 text-purple-800 p-2 rounded-xl flex flex-col items-center justify-center transition-colors border-b-4 border-purple-300 active:border-b-0 active:mt-1">
                <span class="text-2xl">ğŸ®</span>
                <span class="text-xs md:text-sm font-bold">å°éŠæˆ²</span>
            </button>
        </div>
    </nav>

    <!-- è²éŸ³æ•ˆæœ (ä½¿ç”¨ Web Audio API ç”Ÿæˆï¼Œç„¡éœ€å¤–éƒ¨æ–‡ä»¶) -->
    <script>
        // éŸ³æ•ˆåˆæˆå™¨
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'success') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'wrong') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(200, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            }
        }

        // é é¢å…§å®¹æ•¸æ“š
        const scenes = {
            intro: `
                <h2 class="text-3xl font-bold text-blue-600 mb-6">ä»€éº¼æ˜¯æ··åˆç‰©ï¼Ÿ</h2>
                <div class="bg-white p-6 rounded-3xl shadow-xl w-full max-w-lg flex flex-col items-center">
                    <p class="text-xl mb-4 font-bold text-gray-700">æŠŠå…©ç¨®ä¸åŒçš„æ±è¥¿<span class="text-red-500">åŠ åœ¨ä¸€èµ·</span>...</p>
                    
                    <!-- åŸæ–™å€ -->
                    <div class="flex justify-around w-full mb-2 items-center">
                        <div class="flex flex-col items-center transform hover:scale-110 transition-transform">
                            <div class="bg-red-100 p-3 rounded-full mb-2 w-20 h-20 flex justify-center items-center text-5xl shadow-sm border-2 border-red-200">ğŸ</div>
                            <span class="font-bold text-gray-600">è˜‹æœ</span>
                        </div>
                        <div class="text-4xl font-bold text-gray-400 bounce-slow">â•</div>
                        <div class="flex flex-col items-center transform hover:scale-110 transition-transform">
                            <div class="bg-yellow-100 p-3 rounded-full mb-2 w-20 h-20 flex justify-center items-center text-5xl shadow-sm border-2 border-yellow-200">ğŸŒ</div>
                            <span class="font-bold text-gray-600">é¦™è•‰</span>
                        </div>
                    </div>

                    <!-- ç®­é ­ -->
                    <div class="text-4xl text-blue-500 mb-2">â¬‡ï¸</div>

                    <!-- æ··åˆç¢—å€åŸŸ -->
                    <div id="mix-bowl-container" class="relative w-64 h-40 flex justify-center items-end mb-6">
                        <!-- ç¢—çš„å‰åŠéƒ¨ (é®æ“‹ç”¨) -->
                        <div class="absolute bottom-0 w-56 h-28 bg-blue-200 rounded-b-full border-4 border-blue-400 z-20 opacity-90 shadow-lg"></div>
                        <!-- ç¢—çš„å¾ŒåŠéƒ¨ -->
                        <div class="absolute bottom-12 w-56 h-16 bg-blue-300 rounded-[50%] z-0 border-2 border-blue-400"></div>
                        
                        <!-- æ‰è½ç‰©å“å®¹å™¨ -->
                        <div id="mixture-container" class="absolute bottom-4 w-48 h-32 z-10 flex flex-wrap justify-center items-end content-end overflow-hidden">
                            <!-- ç‰©å“æœƒæ‰åˆ°é€™è£¡ -->
                        </div>
                    </div>

                    <button onclick="mixDemo()" id="mix-btn" class="interactive-btn bg-green-500 hover:bg-green-600 text-white text-xl font-bold py-3 px-10 rounded-full shadow-[0_4px_0_rgb(21,128,61)] active:shadow-none active:translate-y-1 transition-all">
                        é–‹å§‹æ··åˆï¼
                    </button>
                    <div id="mix-result-text" class="mt-4 text-3xl font-bold text-purple-600 opacity-0 transition-opacity duration-500">è®Šæˆäº†æ··åˆç‰©ï¼ğŸ¥—</div>
                </div>
            `,
            examples: `
                <h2 class="text-3xl font-bold text-green-600 mb-6">ç”Ÿæ´»ä¸­çš„æ··åˆç‰©</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                    <div class="bg-white p-6 rounded-3xl shadow-lg transform hover:scale-105 transition-transform duration-300">
                        <div class="text-6xl mb-4">ğŸ¥—</div>
                        <h3 class="text-2xl font-bold mb-2">æ²™å¾‹ (æ²™æ‹‰)</h3>
                        <p class="text-gray-500 text-lg">è”¬èœ + æ°´æœ + é†¬æ±</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-lg transform hover:scale-105 transition-transform duration-300">
                        <div class="text-6xl mb-4">ğŸ§‹</div>
                        <h3 class="text-2xl font-bold mb-2">çç å¥¶èŒ¶</h3>
                        <p class="text-gray-500 text-lg">èŒ¶ + å¥¶ + çç </p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-lg transform hover:scale-105 transition-transform duration-300">
                        <div class="text-6xl mb-4">ğŸ¥£</div>
                        <h3 class="text-2xl font-bold mb-2">ç´…è±†æ¹¯</h3>
                        <p class="text-gray-500 text-lg">æ°´ + ç´…è±† + ç³–</p>
                    </div>
                </div>
                <p class="mt-8 text-xl text-gray-600 font-bold bg-white px-6 py-2 rounded-full shadow-sm">é€™äº›æ±è¥¿æ··åœ¨ä¸€èµ·ï¼Œé‚„æ˜¯åŸä¾†çš„æ¨£å­å—ï¼Ÿ</p>
            `,
            methods: `
                <div class="flex flex-col h-full w-full">
                    <h2 class="text-2xl md:text-3xl font-bold text-blue-600 mb-4">åˆ†é›¢æ··åˆç‰©çš„æ–¹æ³•</h2>
                    
                    <!-- æ–¹æ³•é¸æ“‡æŒ‰éˆ• -->
                    <div class="flex flex-wrap justify-center gap-2 mb-4">
                        <button onclick="showMethod('sieve')" class="method-tab bg-orange-100 border-2 border-orange-300 px-4 py-2 rounded-full font-bold text-orange-700 hover:bg-orange-200">ç¯© (Sieving)</button>
                        <button onclick="showMethod('filter')" class="method-tab bg-blue-100 border-2 border-blue-300 px-4 py-2 rounded-full font-bold text-blue-700 hover:bg-blue-200">éæ¿¾ (Filtration)</button>
                        <button onclick="showMethod('magnet')" class="method-tab bg-gray-200 border-2 border-gray-400 px-4 py-2 rounded-full font-bold text-gray-700 hover:bg-gray-300">ç£å¸å¼• (Magnetic)</button>
                        <button onclick="showMethod('evaporate')" class="method-tab bg-red-100 border-2 border-red-300 px-4 py-2 rounded-full font-bold text-red-700 hover:bg-red-200">è’¸ç™¼ (Evaporation)</button>
                    </div>

                    <!-- æ¼”ç¤ºå€åŸŸ -->
                    <div id="demo-area" class="bg-white rounded-3xl shadow-xl flex-1 p-4 relative overflow-hidden border-4 border-dashed border-gray-200 flex flex-col justify-center items-center">
                        <p class="text-gray-400 text-xl">è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•ä¾†å­¸ç¿’æ–¹æ³•</p>
                    </div>
                </div>
            `,
            game: `
                <div class="w-full max-w-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-3xl font-bold text-purple-600">å°éŠæˆ²ï¼šç”¨ä»€éº¼æ–¹æ³•ï¼Ÿ</h2>
                        <div class="bg-yellow-300 px-4 py-2 rounded-full font-bold text-yellow-800 shadow">
                            åˆ†æ•¸: <span id="score">0</span> / <span id="total-q">50</span>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-3xl shadow-xl min-h-[300px] flex flex-col items-center justify-center relative">
                        <div id="game-question" class="w-full">
                            <!-- å•é¡Œæœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                        </div>
                        <div id="feedback" class="absolute inset-0 bg-white/95 rounded-3xl hidden flex-col items-center justify-center z-20 p-4 text-center">
                            <div id="feedback-icon" class="text-8xl mb-2 bounce-slow"></div>
                            <p id="feedback-text" class="text-2xl font-bold text-gray-800 mb-6 leading-relaxed"></p>
                            <button onclick="nextQuestion()" class="bg-blue-500 text-white px-8 py-3 rounded-full text-xl font-bold shadow-lg hover:bg-blue-600 transition-transform active:scale-95">ä¸‹ä¸€é¡Œ</button>
                        </div>
                    </div>
                </div>
            `
        };

        // --- éŠæˆ²æ•¸æ“šåº« (50é¡Œ) ---
        // é¡åˆ¥ï¼šmagnet, sieve, filter, evaporate
        const rawQuestions = [
            { item: "éµé‡˜ + æ²™å­", visual: "ğŸ”© â• ğŸœï¸", answer: "magnet" },
            { item: "éºµç²‰ + ç´…è±†", visual: "ğŸ¥¡ â• ğŸ«˜", answer: "sieve" },
            { item: "é¹½ + æ°´", visual: "ğŸ§‚ â• ğŸ’§", answer: "evaporate" },
            { item: "æ³¥åœŸ + æ°´", visual: "ğŸŸ¤ â• ğŸ’§", answer: "filter" },
            { item: "è¬å­—å¤¾ + ç´™ç¢", visual: "ğŸ–‡ï¸ â• ğŸ“„", answer: "magnet" },
            { item: "çŸ³é ­ + æ²™", visual: "ğŸª¨ â• ğŸœï¸", answer: "sieve" },
            { item: "ç³– + æ°´", visual: "ğŸ¬ â• ğŸ’§", answer: "evaporate" },
            { item: "èŒ¶è‘‰ + èŒ¶", visual: "ğŸ‚ â• ğŸµ", answer: "filter" },
            { item: "é‡ + ç·š", visual: "ğŸª¡ â• ğŸ§µ", answer: "magnet" },
            { item: "ç»ç’ƒç  + æ²™", visual: "ğŸ”® â• ğŸœï¸", answer: "sieve" },
            { item: "å’–å•¡æ¸£ + å’–å•¡", visual: "â˜• â• ğŸ’§", answer: "filter" },
            { item: "æµ·æ°´ (å–é¹½)", visual: "ğŸŒŠ â¡ï¸ ğŸ§‚", answer: "evaporate" },
            { item: "é‘°åŒ™ + è† ç ", visual: "ğŸ”‘ â• ğŸŸ£", answer: "magnet" },
            { item: "ç±³ + ç³ ", visual: "ğŸš â• ğŸŒ¾", answer: "sieve" },
            { item: "æ©™è‚‰ + æ©™æ±", visual: "ğŸŠ â• ğŸ¥¤", answer: "filter" },
            { item: "èºçµ² + æœ¨ç³ ", visual: "ğŸ”© â• ğŸªµ", answer: "magnet" },
            { item: "è²æ®¼ + æ²™", visual: "ğŸš â• ğŸœï¸", answer: "sieve" },
            { item: "é¹½æ°´ (å–é¹½)", visual: "ğŸ¥£ â¡ï¸ ğŸ§‚", answer: "evaporate" },
            { item: "æ¹¯æ¸£ + æ¹¯", visual: "ğŸ² â¡ï¸ ğŸ¥£", answer: "filter" },
            { item: "é‡˜æ›¸é‡˜ + ç±³", visual: "ğŸ–‡ï¸ â• ğŸš", answer: "magnet" },
            { item: "éˆ•æ‰£ + éºµç²‰", visual: "ğŸ”˜ â• ğŸ¥¡", answer: "sieve" },
            { item: "ç³–æ°´ (å–ç³–)", visual: "ğŸ¯ â¡ï¸ ğŸ¬", answer: "evaporate" },
            { item: "è—¥æ¸£ + è—¥æ¹¯", visual: "ğŸŒ¿ â• ğŸ¥£", answer: "filter" },
            { item: "éµç²‰ + ç³–", visual: "âš« â• ğŸ¬", answer: "magnet" },
            { item: "ç¢çŸ³ + æ³¥åœŸ", visual: "ğŸª¨ â• ğŸŸ¤", answer: "sieve" },
            { item: "è±†æ¼¿æ¸£ + è±†æ¼¿", visual: "ğŸ«˜ â• ğŸ¥›", answer: "filter" },
            { item: "é«®å¤¾ + å¸ƒ", visual: "ğŸ§· â• ğŸ‘•", answer: "magnet" },
            { item: "ç±³ + éºµç²‰", visual: "ğŸš â• ğŸ¥¡", answer: "sieve" },
            { item: "æ±½æ°´ (å–ç³–æ¼¿)", visual: "ğŸ¥¤ â¡ï¸ ğŸ¯", answer: "evaporate" },
            { item: "ç²‰ç­†ç° + æ°´", visual: "ğŸ–ï¸ â• ğŸ’§", answer: "filter" },
            { item: "éµåœˆ + è† åœˆ", visual: "â­• â• ğŸ”´", answer: "magnet" },
            { item: "ç²Ÿç±³ç²’ + æ²™", visual: "ğŸŒ½ â• ğŸœï¸", answer: "sieve" },
            { item: "é¹½ç”° (æ›¬é¹½)", visual: "â˜€ï¸ â• ğŸ§‚", answer: "evaporate" },
            { item: "é­šç¼¸æ°´ (å»æ±¡)", visual: "ğŸ  â• ğŸ’©", answer: "filter" },
            { item: "éµå°º + è† å°º", visual: "ğŸ“ â• ğŸ“", answer: "magnet" },
            { item: "ä¹’ä¹“æ³¢ + æ²™", visual: "ğŸ“ â• ğŸœï¸", answer: "sieve" },
            { item: "å¤§å¤ªé™½æ›¬æµ·æ°´", visual: "â˜€ï¸ â• ğŸŒŠ", answer: "evaporate" },
            { item: "æœçš® + æœæ±", visual: "ğŸ â• ğŸ¥¤", answer: "filter" },
            { item: "éµç  + è† ç ", visual: "âš« â• ğŸ”´", answer: "magnet" },
            { item: "å¯¶çŸ³ + æ²™", visual: "ğŸ’ â• ğŸœï¸", answer: "sieve" },
            { item: "é¡è‰²æ°´ (å–è‰²ç´ )", visual: "ğŸ¨ â¡ï¸ ğŸ”´", answer: "evaporate" },
            { item: "éºµæ¢ + ç†±æ°´", visual: "ğŸœ â• ğŸ’§", answer: "filter" },
            { item: "è¬å­—å¤¾ + æ©¡ç­‹", visual: "ğŸ–‡ï¸ â• â­•", answer: "magnet" },
            { item: "éŒ¢å¹£ + æ²™", visual: "ğŸ’° â• ğŸœï¸", answer: "sieve" },
            { item: "é«’æ°´ (è®Šæ¸…æ°´)", visual: "ğŸŸ¤ â¡ï¸ ğŸ’§", answer: "filter" },
            { item: "éµåŒ™ç¾¹ + è† åŒ™ç¾¹", visual: "ğŸ¥„ â• ğŸ¥„", answer: "magnet" },
            { item: "æ¨¹è‘‰ + æ³¥åœŸ", visual: "ğŸƒ â• ğŸŸ¤", answer: "sieve" },
            { item: "ç³–æœ + æ°´ (æº¶åŒ–å¾Œ)", visual: "ğŸ¬ â• ğŸ’§", answer: "evaporate" },
            { item: "èœæ¸£ + æ°´", visual: "ğŸ¥¬ â• ğŸ’§", answer: "filter" },
            { item: "èºçµ²å¸½ + è† ç²’", visual: "ğŸ”© â• ğŸŸ£", answer: "magnet" }
        ];

        // ç­”é¡Œé¸é …å®šç¾©
        const answerOptions = [
            { id: "sieve", label: "ç¯©", icon: "ğŸ•¸ï¸" },
            { id: "magnet", label: "ç£éµ", icon: "ğŸ§²" },
            { id: "filter", label: "éæ¿¾", icon: "ğŸ§ª" },
            { id: "evaporate", label: "è’¸ç™¼", icon: "â˜€ï¸" }
        ];

        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        // åˆå§‹åŒ–
        window.onload = () => {
            navigate('intro');
            prepareQuestions(); // æº–å‚™é¡Œç›®
        };

        // æº–å‚™é¡Œç›®å‡½æ•¸ï¼šå°‡åŸå§‹æ•¸æ“šè½‰æ›ç‚ºéŠæˆ²å¯ç”¨æ ¼å¼
        function prepareQuestions() {
            gameQuestions = rawQuestions.map(q => {
                // æ‰¾å‡ºæ­£ç¢ºç­”æ¡ˆçš„é¸é …
                const correctOpt = answerOptions.find(opt => opt.id === q.answer);
                // æ‰¾å‡ºéŒ¯èª¤ç­”æ¡ˆçš„é¸é … (éæ¿¾æ‰æ­£ç¢ºçš„)
                const wrongOpts = answerOptions.filter(opt => opt.id !== q.answer);
                
                // éš¨æ©Ÿé¸å–2å€‹éŒ¯èª¤é¸é …
                const shuffledWrong = wrongOpts.sort(() => 0.5 - Math.random()).slice(0, 2);
                
                // åˆä½µä¸¦æ‰“äº‚é †åº (1å° + 2éŒ¯)
                const options = [correctOpt, ...shuffledWrong].sort(() => 0.5 - Math.random());
                
                return {
                    ...q,
                    options: options
                };
            });
            // éš¨æ©Ÿæ‰“äº‚é¡Œç›®çš„å‡ºç¾é †åº
            gameQuestions.sort(() => 0.5 - Math.random());
        }

        // å°èˆªå‡½æ•¸
        function navigate(sceneId) {
            playSound('click');
            const container = document.getElementById('scene-container');
            
            // ç°¡å–®çš„æ·¡å‡ºæ•ˆæœ
            container.style.opacity = '0';
            
            setTimeout(() => {
                container.innerHTML = scenes[sceneId];
                container.style.opacity = '1';
                
                // ç‰¹å®šé é¢çš„åˆå§‹åŒ–é‚è¼¯
                if(sceneId === 'methods') {
                    showMethod('sieve'); // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹
                }
                if(sceneId === 'game') {
                    currentQuestionIndex = 0;
                    score = 0;
                    prepareQuestions(); // æ¯æ¬¡é‡ç©éƒ½é‡æ–°æ´—ç‰Œ
                    loadQuestion();
                }
            }, 200);

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.nav-btn').forEach(btn => {
                // é€™è£¡å¯ä»¥æ·»åŠ  active class logicï¼Œç›®å‰ç°¡å–®è™•ç†
            });
        }

        // --- äº’å‹•åŠŸèƒ½ï¼šæ··åˆæ¼”ç¤º ---
        function mixDemo() {
            playSound('click');
            const container = document.getElementById('mixture-container');
            const btn = document.getElementById('mix-btn');
            const resultText = document.getElementById('mix-result-text');
            const bowlContainer = document.getElementById('mix-bowl-container');
            
            // é‡ç½®ç‹€æ…‹
            container.innerHTML = '';
            resultText.style.opacity = '0';
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');

            // è¦åŠ å…¥çš„ç‰©å“
            const items = ['ğŸ', 'ğŸŒ', 'ğŸ', 'ğŸŒ', 'ğŸ', 'ğŸŒ'];
            
            items.forEach((emoji, index) => {
                setTimeout(() => {
                    const item = document.createElement('div');
                    item.textContent = emoji;
                    item.className = "text-4xl absolute transition-all duration-500 ease-in";
                    // éš¨æ©Ÿèµ·å§‹ä½ç½® (åœ¨ç¢—ä¸Šæ–¹)
                    item.style.top = '-80px';
                    item.style.left = (Math.random() * 60 + 20) + '%';
                    item.style.opacity = '0';
                    item.style.transform = `rotate(${Math.random() * 360}deg)`;
                    
                    container.appendChild(item);

                    // è§¸ç™¼æ‰è½å‹•ç•«
                    requestAnimationFrame(() => {
                        item.style.top = (Math.random() * 30 + 30) + 'px'; // æ‰é€²ç¢—è£¡çš„éš¨æ©Ÿé«˜åº¦
                        item.style.left = (Math.random() * 60 + 10) + '%'; // ç¢—è£¡çš„éš¨æ©Ÿæ°´å¹³ä½ç½®
                        item.style.opacity = '1';
                        // æ‰è½æ™‚ç¨å¾®æ—‹è½‰
                        item.style.transform = `rotate(${Math.random() * 360}deg)`;
                    });
                    
                    // è¼•å¾®çš„éŸ³æ•ˆ
                    if(index % 2 === 0) playSound('click'); 
                }, index * 400); // æ¯ 0.4 ç§’æ‰ä¸€å€‹
            });

            // æ‰è½å®Œæˆå¾Œçš„å‹•ä½œ
            setTimeout(() => {
                // æ–æ™ƒç¢—
                if(bowlContainer) {
                    bowlContainer.classList.add('shake');
                    setTimeout(() => bowlContainer.classList.remove('shake'), 500);
                }
                
                // é¡¯ç¤ºçµæœ
                playSound('success');
                resultText.style.opacity = '1';
                
                // æ¢å¾©æŒ‰éˆ•
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                btn.textContent = "å†ç©ä¸€æ¬¡";
            }, items.length * 400 + 500);
        }

        // --- äº’å‹•åŠŸèƒ½ï¼šåˆ†é›¢æ–¹æ³•æ¼”ç¤º ---
        function showMethod(method) {
            playSound('click');
            const demoArea = document.getElementById('demo-area');
            
            // æ›´æ–°Tabæ¨£å¼
            document.querySelectorAll('.method-tab').forEach(btn => {
                if(btn.textContent.includes(method === 'sieve' ? 'ç¯©' : method === 'filter' ? 'éæ¿¾' : method === 'magnet' ? 'ç£' : 'è’¸ç™¼')) {
                    btn.classList.add('ring-2', 'ring-offset-2', 'ring-blue-400', 'scale-105');
                } else {
                    btn.classList.remove('ring-2', 'ring-offset-2', 'ring-blue-400', 'scale-105');
                }
            });

            let content = '';

            if (method === 'sieve') {
                content = `
                    <h3 class="text-xl font-bold mb-2">ç¯© (Sieving)</h3>
                    <p class="mb-4">ç”¨ä¾†åˆ†é–‹ <span class="text-orange-600 font-bold">å¤§</span> å’Œ <span class="text-blue-600 font-bold">å°</span> çš„æ±è¥¿ã€‚</p>
                    <div class="relative w-64 h-64 bg-gray-50 border-2 border-gray-300 rounded-lg flex flex-col items-center pt-4">
                        <!-- ç¯©å­ -->
                        <div class="w-48 h-12 bg-orange-200 border-4 border-orange-400 grid grid-cols-6 gap-1 p-1 z-10">
                            <!-- ç¶²æ ¼ -->
                            ${Array(12).fill('<div class="bg-white opacity-50 w-full h-full"></div>').join('')}
                        </div>
                        
                        <!-- æ‰è½ç‰©å®¹å™¨ -->
                        <div id="sieve-items" class="absolute top-0 w-full flex justify-center flex-wrap gap-2 px-8">
                            <!-- å¤§çŸ³é ­ -->
                            <div class="w-8 h-8 bg-gray-600 rounded-lg shadow-sm"></div>
                            <div class="w-8 h-8 bg-gray-600 rounded-lg shadow-sm"></div>
                            <!-- å°æ²™å­ -->
                            <div class="particle w-3 h-3 bg-yellow-500 rounded-full"></div>
                            <div class="particle w-3 h-3 bg-yellow-500 rounded-full"></div>
                            <div class="particle w-3 h-3 bg-yellow-500 rounded-full"></div>
                        </div>

                        <div class="mt-8 text-gray-400">â¬‡ï¸ å°çš„æ±è¥¿æ‰ä¸‹ä¾†äº†</div>
                    </div>
                    <button onclick="animateSieve()" class="mt-4 bg-green-500 text-white px-6 py-2 rounded-full font-bold hover:bg-green-600 interactive-btn">é–‹å§‹éç¯©</button>
                `;
            } else if (method === 'magnet') {
                content = `
                    <h3 class="text-xl font-bold mb-2">ç£å¸å¼• (Magnetic Attraction)</h3>
                    <p class="mb-4">ç£éµå¯ä»¥å¸èµ· <span class="text-gray-700 font-bold">éµåšçš„</span> æ±è¥¿ã€‚</p>
                    <div class="relative w-64 h-48 bg-yellow-50 rounded-lg border-b-8 border-yellow-200 overflow-hidden">
                        <!-- æ²™å­èƒŒæ™¯ -->
                        <div class="absolute bottom-0 w-full h-12 bg-yellow-200 flex items-end justify-center gap-4 px-4">
                            <!-- éµé‡˜ -->
                            <div class="iron-nail text-2xl transition-all duration-1000">ğŸ”©</div>
                            <div class="plastic text-2xl">ğŸ¥¤</div>
                            <div class="iron-nail text-2xl transition-all duration-1000">ğŸ“</div>
                            <div class="plastic text-2xl">ğŸªµ</div>
                        </div>
                        <!-- ç£éµ -->
                        <div id="magnet-tool" class="absolute top-4 left-4 text-6xl transition-all duration-1000 transform -rotate-45 cursor-pointer">ğŸ§²</div>
                    </div>
                    <button onclick="animateMagnet()" class="mt-4 bg-red-500 text-white px-6 py-2 rounded-full font-bold hover:bg-red-600 interactive-btn">ç§»å‹•ç£éµ</button>
                `;
            } else if (method === 'evaporate') {
                content = `
                    <h3 class="text-xl font-bold mb-2">è’¸ç™¼ (Evaporation)</h3>
                    <p class="mb-4">åŠ ç†±å¾Œï¼Œ<span class="text-blue-500 font-bold">æ°´</span> è®Šæˆæ°´è’¸æ°£é£›èµ°äº†ï¼Œç•™ä¸‹ <span class="text-gray-500 font-bold">é¹½</span>ã€‚</p>
                    <div class="relative w-64 h-56 flex flex-col items-center justify-end">
                        <!-- å¤ªé™½/ç« -->
                        <div id="heat-source" class="text-5xl mb-2 opacity-30 transition-opacity duration-500">ğŸ”¥</div>
                        
                        <!-- ç¢— -->
                        <div class="w-40 h-20 bg-gray-300 rounded-b-full border-4 border-gray-400 relative overflow-hidden">
                            <!-- æ°´ -->
                            <div id="water-body" class="absolute bottom-0 w-full h-full bg-blue-300 transition-all duration-3000 flex items-center justify-center">
                                <span class="text-white opacity-50">ğŸ’§</span>
                            </div>
                            <!-- é¹½ (åˆå§‹éš±è—) -->
                            <div id="salt-crystals" class="absolute bottom-2 w-full flex justify-center gap-1 opacity-0 transition-opacity duration-1000 delay-2000">
                                <div class="w-2 h-2 bg-white rounded-sm"></div>
                                <div class="w-2 h-2 bg-white rounded-sm"></div>
                                <div class="w-2 h-2 bg-white rounded-sm"></div>
                                <div class="w-2 h-2 bg-white rounded-sm"></div>
                            </div>
                        </div>
                    </div>
                    <button onclick="animateEvaporation()" class="mt-4 bg-orange-500 text-white px-6 py-2 rounded-full font-bold hover:bg-orange-600 interactive-btn">é–‹å§‹åŠ ç†±</button>
                `;
            } else if (method === 'filter') {
                content = `
                    <h3 class="text-xl font-bold mb-2">éæ¿¾ (Filtration)</h3>
                    <p class="mb-4">ç”¨æ¿¾ç´™æ“‹ä½ <span class="text-yellow-800 font-bold">æ³¥åœŸ</span>ï¼Œè®“ <span class="text-blue-500 font-bold">æ°´</span> æµéå»ã€‚</p>
                    <div class="relative w-64 h-64 flex flex-col items-center">
                        <!-- æ¼æ–— -->
                        <div class="relative z-10">
                            <div class="w-0 h-0 border-l-[40px] border-l-transparent border-r-[40px] border-r-transparent border-t-[60px] border-t-gray-300"></div>
                            <!-- æ¿¾ç´™å…§çš„é«’æ±è¥¿ -->
                            <div id="filter-dirt" class="absolute top-[-50px] left-[-20px] w-10 h-10 flex justify-center items-center opacity-0 transition-opacity duration-500">
                                <span class="text-yellow-900 text-xl font-bold">ğŸŸ¤</span>
                            </div>
                        </div>
                        
                        <!-- æ¯å­ -->
                        <div class="w-24 h-24 border-b-4 border-l-4 border-r-4 border-gray-400 rounded-b-lg mt-2 relative overflow-hidden bg-white">
                            <!-- ä¹¾æ·¨çš„æ°´ -->
                            <div id="clean-water" class="absolute bottom-0 w-full bg-blue-300 transition-all duration-2000" style="height: 0%"></div>
                        </div>

                        <!-- æ»´æ°´å‹•ç•«å®¹å™¨ -->
                        <div id="drops-container" class="absolute top-20 z-0"></div>
                    </div>
                    <button onclick="animateFilter()" class="mt-4 bg-blue-500 text-white px-6 py-2 rounded-full font-bold hover:bg-blue-600 interactive-btn">å€’å…¥æ³¥æ°´</button>
                `;
            }

            demoArea.innerHTML = content;
        }

        // --- å‹•ç•«é‚è¼¯ ---
        function animateSieve() {
            playSound('click');
            const particles = document.querySelectorAll('.particle');
            particles.forEach(p => {
                p.classList.add('drop-animation');
            });
        }

        function animateMagnet() {
            playSound('click');
            const magnet = document.getElementById('magnet-tool');
            const nails = document.querySelectorAll('.iron-nail');
            
            // ç£éµç§»å‹•
            magnet.style.transform = "translate(100px, 100px) rotate(0deg)";
            
            // éµé‡˜å¸é™„
            setTimeout(() => {
                nails.forEach(nail => {
                    nail.style.transform = "translate(50px, -80px)";
                });
                playSound('success');
            }, 500);
        }

        function animateEvaporation() {
            playSound('click');
            const heat = document.getElementById('heat-source');
            const water = document.getElementById('water-body');
            const salt = document.getElementById('salt-crystals');
            
            heat.style.opacity = '1';
            heat.classList.add('bounce-slow');
            
            // æ°´ä½ä¸‹é™
            water.style.height = '0%';
            water.style.opacity = '0';
            
            // ç”¢ç”Ÿè’¸æ°£æ•ˆæœ (å‹•æ…‹æ·»åŠ  DOM)
            for(let i=0; i<3; i++) {
                setTimeout(() => {
                    const steam = document.createElement('div');
                    steam.textContent = 'â™¨ï¸';
                    steam.className = 'absolute text-2xl steam-animation';
                    steam.style.left = (30 + i*20) + '%';
                    steam.style.bottom = '50px';
                    water.parentElement.appendChild(steam);
                }, i*500);
            }

            // é¡¯ç¤ºé¹½
            setTimeout(() => {
                salt.style.opacity = '1';
                playSound('success');
            }, 2500);
        }

        function animateFilter() {
            playSound('click');
            const dirt = document.getElementById('filter-dirt');
            const cleanWater = document.getElementById('clean-water');
            const container = document.getElementById('drops-container');

            // é¡¯ç¤ºé«’æ±è¥¿è¢«æ“‹ä½
            dirt.style.opacity = '1';

            // æ»´æ°´å‹•ç•«
            for(let i=0; i<5; i++) {
                setTimeout(() => {
                    const drop = document.createElement('div');
                    drop.className = 'w-2 h-4 bg-blue-400 rounded-full absolute drop-animation';
                    container.appendChild(drop);
                }, i*300);
            }

            // æ¯ä¸­æ°´ä½ä¸Šå‡
            setTimeout(() => {
                cleanWater.style.height = '60%';
                playSound('success');
            }, 500);
        }

        // --- éŠæˆ²é‚è¼¯ ---
        function loadQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                showGameEnd();
                return;
            }

            const q = gameQuestions[currentQuestionIndex];
            const qDiv = document.getElementById('game-question');
            const feedback = document.getElementById('feedback');
            
            feedback.classList.add('hidden'); // éš±è—åé¥‹
            feedback.classList.remove('flex');

            let html = `
                <div class="text-center mb-6 fade-in">
                    <p class="text-xl font-bold text-gray-700 mb-2">ç¬¬ ${currentQuestionIndex + 1} é¡Œï¼šè«‹å•å¦‚ä½•åˆ†é›¢</p>
                    <h3 class="text-3xl font-bold text-blue-600 mb-2">${q.item}</h3>
                    <div class="text-5xl mb-6 bg-gray-100 p-4 rounded-xl inline-block">${q.visual}</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
            `;

            q.options.forEach(opt => {
                html += `
                    <button onclick="checkAnswer('${opt.id}', '${q.answer}')" class="game-option bg-white border-4 border-gray-200 p-4 rounded-2xl flex flex-col items-center hover:border-blue-400 hover:bg-blue-50">
                        <span class="text-4xl mb-2">${opt.icon}</span>
                        <span class="text-xl font-bold text-gray-700">${opt.label}</span>
                    </button>
                `;
            });

            html += `</div>`;
            qDiv.innerHTML = html;
        }

        function checkAnswer(selected, correct) {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const text = document.getElementById('feedback-text');
            
            feedback.classList.remove('hidden');
            feedback.classList.add('flex');
            
            // ç²å–æ­£ç¢ºç­”æ¡ˆçš„åç¨±
            const correctOption = answerOptions.find(opt => opt.id === correct);
            const correctLabel = correctOption ? correctOption.label : "";
            
            // æ ¹æ“šåŸç†ç”Ÿæˆè§£é‡‹æ–‡å­—
            let reason = "";
            switch(correct) {
                case 'magnet':
                    reason = `å› ç‚ºé€™è£æœ‰<span class="text-red-500">éµåšçš„æ±è¥¿</span>ï¼Œ<br>æ‰€ä»¥è¦ç”¨ <b>${correctLabel}</b>ã€‚`;
                    break;
                case 'sieve':
                    reason = `å› ç‚ºæ±è¥¿çš„<span class="text-orange-500">å¤§å°ä¸ä¸€æ¨£</span>ï¼Œ<br>æ‰€ä»¥è¦ç”¨ <b>${correctLabel}</b>ã€‚`;
                    break;
                case 'filter':
                    reason = `å› ç‚ºè¦åˆ†é–‹<span class="text-blue-500">æ°´å’Œæ¸£</span>ï¼Œ<br>æ‰€ä»¥è¦ç”¨ <b>${correctLabel}</b>ã€‚`;
                    break;
                case 'evaporate':
                    reason = `å› ç‚ºæƒ³è®“æ°´ä¸è¦‹ã€<span class="text-purple-500">ç•™ä¸‹æ±è¥¿</span>ï¼Œ<br>æ‰€ä»¥è¦ç”¨ <b>${correctLabel}</b>ã€‚`;
                    break;
                default:
                    reason = `æ­£ç¢ºç­”æ¡ˆæ˜¯ <b>${correctLabel}</b>ã€‚`;
            }

            if (selected === correct) {
                playSound('success');
                icon.textContent = 'âœ…';
                icon.className = 'text-8xl mb-2 text-green-500 bounce-slow';
                text.innerHTML = `<span class="text-green-600 text-3xl">ç­”å°äº†ï¼</span><br><br>${reason}`;
                score += 10;
                document.getElementById('score').textContent = score;
            } else {
                playSound('wrong');
                icon.textContent = 'ğŸ’ª'; // åŠ æ²¹
                icon.className = 'text-8xl mb-2 text-orange-500 shake';
                text.innerHTML = `<span class="text-orange-600 text-3xl">åŠ æŠŠå‹ï¼</span><br><br>${reason}`;
                // ç­”éŒ¯ä¸åŠ åˆ†ï¼Œä½†ä¹Ÿæœƒè·³è½‰
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function showGameEnd() {
            const qDiv = document.getElementById('game-question');
            qDiv.innerHTML = `
                <div class="text-center fade-in">
                    <h2 class="text-4xl font-bold text-yellow-500 mb-4">éŠæˆ²çµæŸï¼ğŸ‰</h2>
                    <p class="text-2xl text-gray-700 mb-6">ä½ åšå¾—å¾ˆå¥½ï¼</p>
                    <p class="text-3xl font-bold text-blue-600 mb-8">ç¸½åˆ†: ${score}</p>
                    <button onclick="navigate('game')" class="bg-green-500 text-white px-8 py-3 rounded-full text-xl font-bold shadow-lg hover:bg-green-600">å†ç©ä¸€æ¬¡</button>
                </div>
            `;
            // æ…¶ç¥éŸ³æ•ˆ
            playSound('success');
        }

    </script>
</body>
</html>
