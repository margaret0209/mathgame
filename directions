<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš¨æ©Ÿåœ–æ¡ˆç”Ÿæˆå™¨</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (React version) -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>

    <style>
        /* è‡ªå®šç¾©æ¨£å¼è£œå…… */
        body {
            background-color: #f8fafc; /* bg-slate-50 */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // å¾å…¨åŸŸè®Šæ•¸ä¸­è§£æ§‹æ‰€éœ€çš„ Icon
        const { Settings, RefreshCw, Grid3x3, Grid, LayoutGrid, Award, Anchor, Car, Home, Leaf, Package, Type, Shapes, PenTool, RotateCcw } = lucideReact;
        const { useState, useEffect } = React;

        const RandomPatternGenerator = () => {
            // ç‹€æ…‹ç®¡ç†
            const [gridSize, setGridSize] = useState(3); // 3 (9æ ¼), 4 (16æ ¼), 5 (25æ ¼)
            const [category, setCategory] = useState('animals');
            const [gridData, setGridData] = useState([]);
            const [isAnimating, setIsAnimating] = useState(false);

            // è‡ªè£½é¡Œç›®å€åŸŸçš„ç‹€æ…‹
            const [q1, setQ1] = useState({ p1: '', p2: '', dir: '' });
            const [q2, setQ2] = useState({ p1: '', p2: '', dir: '' });

            // æ–¹å‘é¸é …
            const directions = ['æ±', 'å—', 'è¥¿', 'åŒ—', 'æ±å—', 'æ±åŒ—', 'è¥¿å—', 'è¥¿åŒ—'];

            // å–å¾—ç›®å‰ç¶²æ ¼ä¸­å­˜åœ¨çš„åœ–æ¡ˆ (éæ¿¾æ‰ null)
            const availablePatterns = gridData.filter(item => item !== null);

            // å®šç¾©é¡åˆ¥èˆ‡å°æ‡‰çš„ Emoji ç´ æåº«
            const categories = {
                buildings: {
                label: 'å»ºç¯‰ç‰©',
                icon: <Home className="w-4 h-4 mr-2" />,
                items: ['ğŸ ', 'ğŸ¢', 'ğŸ£', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸ°', 'ğŸ¯', 'â›ª', 'ğŸ•Œ', 'â›º', 'ğŸ­', 'ğŸ«', 'ğŸ›ï¸', 'ğŸ—¼', 'ğŸ—½']
                },
                animals: {
                label: 'å‹•ç‰©',
                icon: <Award className="w-4 h-4 mr-2" />,
                items: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”']
                },
                vehicles: {
                label: 'äº¤é€šå·¥å…·',
                icon: <Car className="w-4 h-4 mr-2" />,
                items: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸšœ', 'ğŸ›µ', 'ğŸï¸', 'ğŸš‚', 'âœˆï¸', 'ğŸš€', 'ğŸš']
                },
                items: {
                label: 'ç‰©å“',
                icon: <Package className="w-4 h-4 mr-2" />,
                items: ['ğŸ’', 'âŒš', 'ğŸ“±', 'ğŸ’»', 'ğŸ“·', 'ğŸ“¹', 'ğŸ“¼', 'ğŸ”', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ“•', 'âœï¸', 'ğŸ–Œï¸', 'ğŸ”‘', 'ğŸ', 'ğŸ””']
                },
                nature: {
                label: 'å‹•æ¤ç‰©',
                icon: <Leaf className="w-4 h-4 mr-2" />,
                items: ['ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ·', 'ğŸŒ¸', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒ¾', 'ğŸŒ¿', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸ„']
                },
                marine: {
                label: 'æµ·æ´‹ç”Ÿç‰©',
                icon: <Anchor className="w-4 h-4 mr-2" />,
                items: ['ğŸ³', 'ğŸ‹', 'ğŸ¬', 'ğŸŸ', 'ğŸ ', 'ğŸ¡', 'ğŸ¦ˆ', 'ğŸ™', 'ğŸš', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦‘', 'ğŸŠ', 'ğŸ¢', 'ğŸ§Š']
                },
                letters: {
                label: 'è‹±æ–‡å­—æ¯',
                icon: <Type className="w-4 h-4 mr-2" />,
                // å·²ç§»é™¤ N, E, S, W
                items: ['A', 'B', 'C', 'D', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'O', 'P', 'Q', 'R', 'T', 'U', 'V', 'X', 'Y', 'Z']
                },
                shapes: {
                label: 'å½¢ç‹€',
                icon: <Shapes className="w-4 h-4 mr-2" />,
                // ç¢ºä¿å½¢ç‹€å¹¾ä½•ç‰¹å¾µä¸é‡è¤‡
                items: ['ğŸ”´', 'ğŸŸ¦', 'ğŸ”º', 'ğŸ”¶', 'â­', 'â¤ï¸', 'ğŸŒ™', 'ğŸŒ€', 'âœ–ï¸', 'âœ…', 'â˜ï¸', 'â˜€ï¸', 'â™ ï¸', 'â™£ï¸', 'ğŸ’§', 'âš¡']
                }
            };

            // ç”Ÿæˆç¶²æ ¼é‚è¼¯
            const generateGrid = () => {
                setIsAnimating(true);
                
                // ç¨å¾®å»¶é²ä»¥å±•ç¤ºå‹•ç•«æ•ˆæœ
                setTimeout(() => {
                const totalCells = gridSize * gridSize;
                let fillCount = 0;

                // æ ¹æ“šé¡Œç›®è¦æ±‚è¨­å®šå¡«å…¥çš„æ•¸é‡
                if (gridSize === 3) fillCount = 4;      // 9æ ¼æ¨¡å¼ï¼šå¡«4æ ¼
                else if (gridSize === 4) fillCount = 8; // 16æ ¼æ¨¡å¼ï¼šå¡«8æ ¼
                else if (gridSize === 5) fillCount = 10;// 25æ ¼æ¨¡å¼ï¼šå¡«10æ ¼

                // å»ºç«‹ç©ºé™£åˆ—
                const newGrid = new Array(totalCells).fill(null);
                
                // ç”¢ç”Ÿéš¨æ©Ÿç´¢å¼• (Fisher-Yates Shuffle è®Šé«”)
                const indices = Array.from({ length: totalCells }, (_, i) => i);
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                
                // å–å‰ fillCount å€‹ç´¢å¼•ä½œç‚ºè¦å¡«å……çš„ä½ç½®
                const selectedIndices = indices.slice(0, fillCount);

                // å¡«å……å…§å®¹
                const currentItems = categories[category].items;
                
                // ç‚ºäº†ç¢ºä¿åœ–æ¡ˆä¸é‡è¤‡ï¼Œå…ˆæ´—ç‰Œæ‰€æœ‰åœ–æ¡ˆ (Fisher-Yates Shuffle)
                const shuffledItems = [...currentItems];
                for (let i = shuffledItems.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledItems[i], shuffledItems[j]] = [shuffledItems[j], shuffledItems[i]];
                }
                
                // ä¾åºå¡«å…¥ä¸é‡è¤‡çš„åœ–æ¡ˆ
                selectedIndices.forEach((index, i) => {
                    newGrid[index] = shuffledItems[i];
                });

                setGridData(newGrid);
                setIsAnimating(false);
                }, 150);
            };

            // é‡ç½®é¡Œç›®å€åŸŸ
            const resetQuestions = () => {
                setQ1({ p1: '', p2: '', dir: '' });
                setQ2({ p1: '', p2: '', dir: '' });
            };

            // ç•¶æ¨¡å¼æˆ–é¡åˆ¥æ”¹è®Šæ™‚ï¼Œè‡ªå‹•é‡æ–°ç”Ÿæˆï¼Œä¸¦æ¸…ç©ºé¡Œç›®
            useEffect(() => {
                generateGrid();
                resetQuestions();
            }, [gridSize, category]);

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-indigo-100 p-4 md:p-8">
                <div className="max-w-4xl mx-auto">
                    
                    {/* æ¨™é¡Œå€ */}
                    <header className="mb-8 text-center">
                    <h1 className="text-3xl md:text-4xl font-extrabold text-indigo-600 mb-2 flex items-center justify-center gap-3">
                        <Settings className="w-8 h-8" />
                        éš¨æ©Ÿåœ–æ¡ˆç”Ÿæˆå™¨
                    </h1>
                    <p className="text-slate-500">é¸æ“‡é¡åˆ¥èˆ‡ç¶²æ ¼å¤§å°ï¼Œè‡ªå‹•ç”Ÿæˆéš¨æ©Ÿåˆ†ä½ˆåœ–æ¡ˆ</p>
                    </header>

                    {/* æ§åˆ¶é¢æ¿ */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-slate-100">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        
                        {/* é¡åˆ¥é¸æ“‡ */}
                        <div>
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3">
                            1. é¸æ“‡é¡åˆ¥
                        </h3>
                        <div className="grid grid-cols-2 sm:grid-cols-3 gap-2">
                            {Object.entries(categories).map(([key, value]) => (
                            <button
                                key={key}
                                onClick={() => setCategory(key)}
                                className={`flex items-center justify-center px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 border
                                ${category === key 
                                    ? 'bg-indigo-100 text-indigo-700 border-indigo-200 shadow-inner' 
                                    : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50 hover:border-slate-300'
                                }`}
                            >
                                {value.icon}
                                {value.label}
                            </button>
                            ))}
                        </div>
                        </div>

                        {/* ç¶²æ ¼æ¨¡å¼é¸æ“‡ */}
                        <div>
                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3">
                            2. é¸æ“‡ç¶²æ ¼æ¨¡å¼
                        </h3>
                        <div className="flex flex-wrap gap-3 mb-4">
                            <button
                            onClick={() => setGridSize(3)}
                            className={`flex-1 flex flex-col items-center justify-center p-3 rounded-xl border-2 transition-all duration-200
                                ${gridSize === 3 
                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700' 
                                : 'border-slate-200 bg-white text-slate-500 hover:border-slate-300'
                                }`}
                            >
                            <Grid3x3 className="w-6 h-6 mb-1" />
                            <span className="font-bold">9æ ¼</span>
                            <span className="text-xs opacity-75">(3x3, é¸4)</span>
                            </button>
                            
                            <button
                            onClick={() => setGridSize(4)}
                            className={`flex-1 flex flex-col items-center justify-center p-3 rounded-xl border-2 transition-all duration-200
                                ${gridSize === 4 
                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700' 
                                : 'border-slate-200 bg-white text-slate-500 hover:border-slate-300'
                                }`}
                            >
                            <Grid className="w-6 h-6 mb-1" />
                            <span className="font-bold">16æ ¼</span>
                            <span className="text-xs opacity-75">(4x4, é¸8)</span>
                            </button>

                            <button
                            onClick={() => setGridSize(5)}
                            className={`flex-1 flex flex-col items-center justify-center p-3 rounded-xl border-2 transition-all duration-200
                                ${gridSize === 5 
                                ? 'border-indigo-500 bg-indigo-50 text-indigo-700' 
                                : 'border-slate-200 bg-white text-slate-500 hover:border-slate-300'
                                }`}
                            >
                            <LayoutGrid className="w-6 h-6 mb-1" />
                            <span className="font-bold">25æ ¼</span>
                            <span className="text-xs opacity-75">(5x5, é¸10)</span>
                            </button>
                        </div>

                        {/* é‡æ–°ç”ŸæˆæŒ‰éˆ• */}
                        <button
                            onClick={generateGrid}
                            className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 active:scale-[0.98] text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg"
                        >
                            <RefreshCw className={`w-5 h-5 ${isAnimating ? 'animate-spin' : ''}`} />
                            é‡æ–°éš¨æ©Ÿç”Ÿæˆ
                        </button>
                        </div>
                    </div>
                    </div>

                    {/* é¡¯ç¤ºå€åŸŸ */}
                    <div className="flex justify-center mb-8">
                    <div 
                        className={`
                        grid gap-2 md:gap-3 p-4 bg-white rounded-2xl shadow-xl border-4 border-slate-200
                        transition-all duration-300 ease-in-out
                        ${gridSize === 3 ? 'grid-cols-3 w-full max-w-[400px]' : ''}
                        ${gridSize === 4 ? 'grid-cols-4 w-full max-w-[480px]' : ''}
                        ${gridSize === 5 ? 'grid-cols-5 w-full max-w-[550px]' : ''}
                        `}
                    >
                        {gridData.map((item, index) => (
                        <div
                            key={`${gridSize}-${index}-${item || 'empty'}`}
                            className={`
                            aspect-square rounded-xl flex items-center justify-center text-3xl md:text-4xl lg:text-5xl select-none
                            transition-all duration-500
                            ${item 
                                ? 'bg-indigo-50 border-2 border-indigo-200 shadow-sm scale-100 opacity-100' 
                                : 'bg-slate-100/50 scale-95 opacity-50'
                            }
                            `}
                        >
                            <span className={`transform transition-transform duration-300 ${isAnimating ? 'scale-0' : 'scale-100'}`}>
                            {item}
                            </span>
                        </div>
                        ))}
                    </div>
                    </div>

                    {/* è‡ªè£½é¡Œç›®å€åŸŸ */}
                    <div className="bg-white rounded-2xl shadow-lg p-6 border-2 border-indigo-100 max-w-3xl mx-auto">
                    <h3 className="text-xl font-bold text-indigo-700 mb-6 flex items-center gap-2 border-b border-indigo-100 pb-3">
                        <PenTool className="w-6 h-6" />
                        è‡ªè£½é¡Œç›®å€åŸŸ
                    </h3>
                    
                    <div className="space-y-6">
                        {/* é¡Œç›® 1 */}
                        <div className="flex flex-wrap items-center gap-2 md:gap-3 text-lg md:text-xl font-medium p-4 bg-slate-50 rounded-xl border border-slate-200 shadow-sm">
                        <span className="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0 shadow-sm">1</span>
                        
                        <div className="flex items-center gap-2 flex-wrap">
                            <select 
                            value={q1.p1} 
                            onChange={(e) => setQ1({...q1, p1: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-2 py-1 text-2xl md:text-3xl min-w-[4rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm text-center appearance-none"
                            style={{backgroundImage: 'none'}}
                            >
                            <option value="">?</option>
                            {availablePatterns.map((p, i) => <option key={`q1p1-${i}`} value={p}>{p}</option>)}
                            </select>
                            
                            <span className="text-slate-600">åœ¨</span>
                            
                            <select 
                            value={q1.p2}
                            onChange={(e) => setQ1({...q1, p2: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-2 py-1 text-2xl md:text-3xl min-w-[4rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm text-center appearance-none"
                            style={{backgroundImage: 'none'}}
                            >
                            <option value="">?</option>
                            {availablePatterns.map((p, i) => <option key={`q1p2-${i}`} value={p}>{p}</option>)}
                            </select>
                            
                            <span className="text-slate-600">çš„</span>
                            
                            <select 
                            value={q1.dir}
                            onChange={(e) => setQ1({...q1, dir: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-3 py-1 text-base md:text-lg min-w-[5rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm"
                            >
                            <option value="">æ–¹å‘</option>
                            {directions.map(d => <option key={d} value={d}>{d}</option>)}
                            </select>
                            
                            <span className="text-slate-600">æ–¹ã€‚</span>
                        </div>
                        </div>

                        {/* é¡Œç›® 2 */}
                        <div className="flex flex-wrap items-center gap-2 md:gap-3 text-lg md:text-xl font-medium p-4 bg-slate-50 rounded-xl border border-slate-200 shadow-sm">
                        <span className="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0 shadow-sm">2</span>
                        
                        <div className="flex items-center gap-2 flex-wrap">
                            <select 
                            value={q2.p1}
                            onChange={(e) => setQ2({...q2, p1: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-2 py-1 text-2xl md:text-3xl min-w-[4rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm text-center appearance-none"
                            style={{backgroundImage: 'none'}}
                            >
                            <option value="">?</option>
                            {availablePatterns.map((p, i) => <option key={`q2p1-${i}`} value={p}>{p}</option>)}
                            </select>
                            
                            <span className="text-slate-600">çš„</span>
                            
                            <select 
                            value={q2.dir}
                            onChange={(e) => setQ2({...q2, dir: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-3 py-1 text-base md:text-lg min-w-[5rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm"
                            >
                            <option value="">æ–¹å‘</option>
                            {directions.map(d => <option key={d} value={d}>{d}</option>)}
                            </select>
                            
                            <span className="text-slate-600">æ–¹æ˜¯</span>
                            
                            <select 
                            value={q2.p2}
                            onChange={(e) => setQ2({...q2, p2: e.target.value})}
                            className="bg-white border-2 border-indigo-200 rounded-lg px-2 py-1 text-2xl md:text-3xl min-w-[4rem] h-12 md:h-14 focus:outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 cursor-pointer shadow-sm text-center appearance-none"
                            style={{backgroundImage: 'none'}}
                            >
                            <option value="">?</option>
                            {availablePatterns.map((p, i) => <option key={`q2p2-${i}`} value={p}>{p}</option>)}
                            </select>
                            
                            <span className="text-slate-600">ã€‚</span>
                        </div>
                        </div>
                    </div>

                    <div className="mt-6 flex justify-end">
                        <button 
                        onClick={resetQuestions}
                        className="flex items-center gap-2 px-4 py-2 text-slate-500 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors font-medium text-sm group"
                        >
                        <RotateCcw className="w-4 h-4 group-hover:-rotate-180 transition-transform duration-500" />
                        æ¸…ç©ºé¡Œç›®
                        </button>
                    </div>
                    </div>

                    {/* åº•éƒ¨èªªæ˜ */}
                    <div className="text-center mt-8 text-slate-400 text-sm">
                    <p>ç•¶å‰æ¨¡å¼ï¼š{categories[category].label} / {gridSize}x{gridSize} ç¶²æ ¼</p>
                    </div>

                </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RandomPatternGenerator />);
    </script>
</body>
</html>
