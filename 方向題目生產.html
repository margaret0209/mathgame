<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš¨æ©Ÿåœ–æ¡ˆç”Ÿæˆå™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
        }

        /* Card Animation */
        .grid-cell {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(0);
            opacity: 0;
        }

        .grid-cell.active {
            transform: scale(1);
            opacity: 1;
        }

        .grid-cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Empty cell styling */
        .empty-cell {
            background-color: #e2e8f0;
            border-radius: 0.75rem;
        }

        /* Custom Select Styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 3rem;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center py-8 px-4">

    <!-- Width increased to max-w-6xl to accommodate side-by-side layout -->
    <div class="bg-white w-full max-w-6xl rounded-2xl shadow-xl overflow-hidden border border-slate-200">
        <!-- Header -->
        <div class="bg-indigo-600 p-6 text-center">
            <h1 class="text-3xl font-bold text-white tracking-wide">ğŸ² éš¨æ©Ÿåœ–æ¡ˆç”Ÿæˆå™¨</h1>
            <p class="text-indigo-100 text-base mt-2">é¸æ“‡é¡åˆ¥èˆ‡å¤§å°ï¼Œç”Ÿæˆç¨ç‰¹çš„æ’åˆ—çµ„åˆ</p>
        </div>

        <div class="p-6 space-y-8">
            <!-- Controls Section (Full Width) -->
            <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm space-y-4">
                <!-- Category Selection -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">1. é¸æ“‡é¡åˆ¥</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2" id="category-container">
                        <!-- Buttons injected by JS -->
                    </div>
                </div>

                <!-- Grid Size Selection -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">2. é¸æ“‡æ–¹æ ¼æ¨¡å¼</label>
                    <div class="flex rounded-md shadow-sm w-full max-w-md" role="group">
                        <button onclick="setGridSize(9)" id="btn-9" class="grid-size-btn flex-1 px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-l-lg hover:bg-slate-50 focus:z-10 focus:ring-2 focus:ring-indigo-500 focus:text-indigo-600 transition-colors">
                            9æ ¼ (3x3)
                        </button>
                        <button onclick="setGridSize(16)" id="btn-16" class="grid-size-btn flex-1 px-4 py-2 text-sm font-medium text-slate-700 bg-white border-t border-b border-slate-300 hover:bg-slate-50 focus:z-10 focus:ring-2 focus:ring-indigo-500 focus:text-indigo-600 transition-colors">
                            16æ ¼ (4x4)
                        </button>
                        <button onclick="setGridSize(25)" id="btn-25" class="grid-size-btn flex-1 px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-r-lg hover:bg-slate-50 focus:z-10 focus:ring-2 focus:ring-indigo-500 focus:text-indigo-600 transition-colors">
                            25æ ¼ (5x5)
                        </button>
                    </div>
                </div>

                <!-- Action Button -->
                <button onclick="generateGrid()" class="w-full max-w-md bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors shadow-md flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    é‡æ–°ç”Ÿæˆ
                </button>
            </div>

            <!-- Main Content Area: Flex container for Side-by-Side layout -->
            <div class="flex flex-col lg:flex-row gap-8 items-start">
                
                <!-- LEFT: Grid Display -->
                <div class="w-full lg:w-5/12 xl:w-1/3 shrink-0">
                    <div class="bg-slate-50 rounded-xl p-4 min-h-[300px] flex items-center justify-center border border-slate-200 shadow-inner relative sticky top-6">
                        
                        <!-- Status Text -->
                        <div id="status-text" class="absolute top-2 left-4 text-xs font-mono text-slate-400">
                            æ¨¡å¼: <span id="current-mode-display">9æ ¼</span> | ç”Ÿæˆ: <span id="current-count-display">5å€‹</span>
                        </div>

                        <!-- The Grid -->
                        <div id="grid-container" class="grid gap-3 w-full max-w-[400px] mx-auto transition-all duration-300">
                            <!-- Grid items will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Custom Question Area (Magnified) -->
                <div class="w-full lg:flex-1">
                    <div class="bg-indigo-50 p-8 rounded-2xl border-2 border-indigo-100 shadow-md h-full">
                        <div class="flex flex-wrap items-center justify-between mb-8 gap-4">
                            <h3 class="text-3xl font-bold text-indigo-900 flex items-center gap-3">
                                <span class="text-4xl">âœï¸</span> è‡ªè£½é¡Œç›®
                            </h3>
                            <button onclick="resetQuestions()" class="text-lg text-slate-500 hover:text-red-500 font-medium flex items-center gap-2 transition-colors px-4 py-2 rounded-full hover:bg-white bg-white/50 border border-transparent hover:border-red-200 shadow-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                                æ¸…ç©º
                            </button>
                        </div>
                        
                        <div class="space-y-8">
                            <!-- Question 1 (Magnified) -->
                            <div class="flex flex-wrap items-center gap-3 text-slate-700 font-bold text-2xl leading-loose">
                                <span class="bg-indigo-600 text-white text-xl px-4 py-2 rounded-lg shadow-sm shrink-0">1</span>
                                <select id="q1-p1" class="pattern-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap mx-1">åœ¨</span>
                                <select id="q1-p2" class="pattern-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap mx-1">çš„</span>
                                <select id="q1-dir" class="dir-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap">æ–¹ã€‚</span>
                            </div>

                            <div class="border-t-2 border-indigo-200 border-dashed"></div>

                            <!-- Question 2 (Magnified) -->
                            <div class="flex flex-wrap items-center gap-3 text-slate-700 font-bold text-2xl leading-loose">
                                <span class="bg-indigo-600 text-white text-xl px-4 py-2 rounded-lg shadow-sm shrink-0">2</span>
                                <select id="q2-p1" class="pattern-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap mx-1">çš„</span>
                                <select id="q2-dir" class="dir-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap mx-1">æ–¹æ˜¯</span>
                                <select id="q2-p2" class="pattern-select bg-white border-2 border-indigo-200 rounded-xl px-4 py-3 text-2xl text-slate-800 focus:ring-4 focus:ring-indigo-200 focus:border-indigo-500 outline-none shadow-sm cursor-pointer min-w-[120px] hover:border-indigo-300 transition-colors"></select>
                                <span class="whitespace-nowrap">ã€‚</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration Data ---
        const categories = {
            'building': {
                label: 'å»ºç¯‰ç‰©',
                icon: 'ğŸ™ï¸',
                items: ['ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸª', 'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ¯', 'ğŸ°', 'ğŸ’’', 'ğŸ—¼', 'ğŸ—½', 'â›ª', 'ğŸ›–', 'â›º']
            },
            'animal': {
                label: 'å‹•ç‰©',
                icon: 'ğŸ¦',
                items: ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¦†', 'ğŸ¦…']
            },
            'vehicle': {
                label: 'äº¤é€šå·¥å…·',
                icon: 'ğŸš—',
                items: ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸšš', 'ğŸšœ', 'ğŸ›µ', 'ğŸï¸', 'ğŸš‚', 'ğŸš†', 'ğŸš„', 'ğŸš…', 'âœˆï¸', 'ğŸš', 'ğŸš€', 'ğŸ›¸']
            },
            'item': {
                label: 'ç‰©å“',
                icon: 'ğŸ',
                items: ['âŒš', 'ğŸ“±', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'ğŸ–±ï¸', 'ğŸ“·', 'ğŸ“¹', 'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸', 'ğŸ“', 'â°', 'â³', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ“š', 'ğŸ“•', 'ğŸ§¸', 'ğŸ', 'ğŸ’', 'ğŸ”‘', 'ğŸ”¨']
            },
            'nature': {
                label: 'å‹•æ¤ç‰©',
                icon: 'ğŸŒ»',
                items: ['ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸŒµ', 'ğŸŒ·', 'ğŸŒ¸', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸŒ¾', 'ğŸŒ¿', 'â˜˜ï¸', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸƒ', 'ğŸ„', 'ğŸªµ', 'ğŸª´']
            },
            'marine': {
                label: 'æµ·æ´‹ç”Ÿç‰©',
                icon: 'ğŸ¬',
                items: ['ğŸŸ', 'ğŸ ', 'ğŸ¡', 'ğŸ¦ˆ', 'ğŸ™', 'ğŸš', 'ğŸ¦€', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦‘', 'ğŸ‹', 'ğŸ³', 'ğŸ¬', 'ğŸ¦­', 'ğŸŠ', 'ğŸ¢', 'ğŸŠ', 'ğŸŒŠ', 'âš“', 'ğŸ›³ï¸']
            },
            'letter': {
                label: 'è‹±æ–‡å­—æ¯',
                icon: 'ğŸ” ',
                items: ['A', 'B', 'C', 'D', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'O', 'P', 'Q', 'R', 'T', 'U', 'V', 'X', 'Y', 'Z']
            },
            'shape': {
                label: 'å½¢ç‹€',
                icon: 'ğŸ”¶',
                // Shapes curated to avoid duplicates (e.g., only one Circle, one Square type)
                items: ['ğŸ”´', 'ğŸŸ¥', 'ğŸ”º', 'ğŸ”¶', 'â­', 'ğŸ’œ', 'ğŸŒ€', 'âœ–ï¸', 'â•', 'ğŸŒ™', 'âš¡', 'â„ï¸', 'ğŸ’§', 'ğŸ›‘', 'ğŸ”°', 'â™¾ï¸', 'ğŸ—¯ï¸', 'ğŸµ', 'â™ ï¸', 'â™£ï¸']
            }
        };

        const directionsList = ['æ±', 'å—', 'è¥¿', 'åŒ—', 'æ±å—', 'æ±åŒ—', 'è¥¿å—', 'è¥¿åŒ—'];

        // --- State ---
        let currentCategory = 'building';
        let currentSize = 9; // 9, 16, or 25
        let currentActivePatterns = []; // Stores the patterns currently visible in grid

        // --- DOM Elements ---
        const gridContainer = document.getElementById('grid-container');
        const categoryContainer = document.getElementById('category-container');
        const statusModeDisplay = document.getElementById('current-mode-display');
        const statusCountDisplay = document.getElementById('current-count-display');

        // --- Initialization ---
        function init() {
            renderCategoryButtons();
            setGridSize(9); // Default
        }

        // --- Render Category Buttons ---
        function renderCategoryButtons() {
            categoryContainer.innerHTML = '';
            for (const [key, data] of Object.entries(categories)) {
                const btn = document.createElement('button');
                btn.className = `cat-btn px-2 py-2 rounded-lg text-sm font-medium border transition-all flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 ${key === currentCategory ? 'bg-indigo-100 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500' : 'bg-white border-slate-200 text-slate-600 hover:border-indigo-300 hover:bg-slate-50'}`;
                btn.onclick = () => setCategory(key);
                btn.innerHTML = `<span class="text-lg">${data.icon}</span> <span>${data.label}</span>`;
                btn.dataset.category = key;
                categoryContainer.appendChild(btn);
            }
        }

        // --- Logic Functions ---

        function setCategory(catKey) {
            currentCategory = catKey;
            
            // Update button styles
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.dataset.category === catKey) {
                    btn.className = 'cat-btn px-2 py-2 rounded-lg text-sm font-medium border transition-all flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 bg-indigo-100 border-indigo-500 text-indigo-700 ring-1 ring-indigo-500';
                } else {
                    btn.className = 'cat-btn px-2 py-2 rounded-lg text-sm font-medium border transition-all flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 bg-white border-slate-200 text-slate-600 hover:border-indigo-300 hover:bg-slate-50';
                }
            });

            generateGrid();
        }

        function setGridSize(size) {
            currentSize = size;
            
            // Update Button Styles
            [9, 16, 25].forEach(s => {
                const btn = document.getElementById(`btn-${s}`);
                if (s === size) {
                    btn.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600');
                    btn.classList.remove('bg-white', 'text-slate-700', 'hover:bg-slate-50');
                } else {
                    btn.classList.remove('bg-indigo-600', 'text-white', 'border-indigo-600');
                    btn.classList.add('bg-white', 'text-slate-700', 'hover:bg-slate-50');
                }
            });

            // Update Status Text
            statusModeDisplay.textContent = `${size}æ ¼`;
            let count = 0;
            if(size === 9) count = 5;
            if(size === 16) count = 8;
            if(size === 25) count = 10;
            statusCountDisplay.textContent = `${count}å€‹`;

            generateGrid();
        }

        function getRandomItems(array, count) {
            // Shuffle array copy
            const shuffled = [...array].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function generateGrid() {
            // Clear grid & Active patterns state
            gridContainer.innerHTML = '';
            currentActivePatterns = [];

            // Set Grid CSS columns
            gridContainer.className = 'grid gap-3 w-full max-w-[400px] mx-auto transition-all duration-300';
            if (currentSize === 9) {
                gridContainer.classList.add('grid-cols-3');
            } else if (currentSize === 16) {
                gridContainer.classList.add('grid-cols-4');
            } else {
                gridContainer.classList.add('grid-cols-5');
            }

            // Determine Fill Count
            let fillCount = 0;
            if (currentSize === 9) fillCount = 5;
            else if (currentSize === 16) fillCount = 8;
            else if (currentSize === 25) fillCount = 10;

            // Generate Indices for filled spots
            const allIndices = Array.from({length: currentSize}, (_, i) => i);
            const filledIndices = new Set(getRandomItems(allIndices, fillCount));

            // Get random items for the active cells
            const categoryData = categories[currentCategory];
            
            // Get exact number of UNIQUE items needed
            const uniqueItems = getRandomItems(categoryData.items, fillCount);
            let itemIndex = 0;
            
            // Generate HTML
            for (let i = 0; i < currentSize; i++) {
                const cell = document.createElement('div');
                
                if (filledIndices.has(i)) {
                    // Active Cell
                    const randomItem = uniqueItems[itemIndex];
                    itemIndex++;
                    
                    // Track this item for the questions dropdown
                    currentActivePatterns.push(randomItem);
                    
                    cell.className = 'grid-cell bg-white rounded-xl shadow-sm border border-slate-200 flex items-center justify-center text-3xl md:text-4xl font-bold text-slate-700 aspect-square cursor-default select-none';
                    cell.textContent = randomItem;
                    
                    setTimeout(() => {
                        cell.classList.add('active');
                    }, i * 30);
                } else {
                    // Empty Cell
                    cell.className = 'empty-cell aspect-square opacity-50';
                }
                
                gridContainer.appendChild(cell);
            }

            // Update the questions area with new patterns
            updateQuestionDropdowns();
        }

        // --- Custom Question Logic ---

        function updateQuestionDropdowns() {
            // 1. Populate Pattern Dropdowns
            const patternSelects = document.querySelectorAll('.pattern-select');
            patternSelects.forEach(select => {
                // Keep the currently selected value if possible
                const currentVal = select.value;
                
                // Clear existing
                select.innerHTML = '<option value="">åœ–æ¡ˆ</option>';
                // Add current patterns
                currentActivePatterns.forEach(pattern => {
                    const option = document.createElement('option');
                    option.value = pattern;
                    option.textContent = pattern;
                    select.appendChild(option);
                });

                // Restore value if it still exists in the new set (optional, but nice UX)
                // However, user usually wants to generate new grid then make new questions, 
                // so keeping selection might be confusing if the position changed.
                // Resetting is safer as per previous logic.
            });

            // 2. Populate Direction Dropdowns (only needs to run once essentially, but safe to rerun)
            const dirSelects = document.querySelectorAll('.dir-select');
            dirSelects.forEach(select => {
                // Only populate if empty (or just reset to be safe)
                if(select.options.length <= 1) { 
                    select.innerHTML = '<option value="">æ–¹å‘</option>';
                    directionsList.forEach(dir => {
                        const option = document.createElement('option');
                        option.value = dir;
                        option.textContent = dir;
                        select.appendChild(option);
                    });
                }
            });
            
            // Always reset questions on new grid generation as the old items might not exist
            resetQuestions();
        }

        function resetQuestions() {
            const allSelects = document.querySelectorAll('.pattern-select, .dir-select');
            allSelects.forEach(select => {
                select.value = "";
            });
        }

        // Run Init
        init();

    </script>
</body>
</html>