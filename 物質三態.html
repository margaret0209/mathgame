<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©è³ªä¸‰æ…‹æ¢ç´¢æ¨‚åœ’</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* è‡ªå®šç¾©å‹•ç•« */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle {
            animation: wiggle 1s ease-in-out infinite;
        }
        .btn-press:active {
            transform: scale(0.95);
        }
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ */
        }
        .particle {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
        }
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-yellow-50 min-h-screen flex flex-col items-center p-2 md:p-4">

    <!-- å°èˆªåˆ— (æŒ‰éˆ•å€) -->
    <nav class="w-full max-w-3xl bg-white rounded-2xl shadow-lg p-3 mb-4 flex flex-col md:flex-row justify-between items-center gap-2">
        <div class="text-xl font-bold text-orange-500 whitespace-nowrap hidden md:block">å¿«æ¨‚å­¸ç§‘å­¸</div>
        <div class="flex space-x-2 w-full md:w-auto overflow-x-auto no-scrollbar">
            <button onclick="goToScreen('screen-home')" class="nav-btn flex-1 md:flex-none whitespace-nowrap px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold text-sm md:text-base transition border-b-4 border-gray-300 active:border-b-0 active:translate-y-1">
                é¦–é 
            </button>
            <button onclick="goToScreen('screen-learn')" class="nav-btn flex-1 md:flex-none whitespace-nowrap px-4 py-2 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold text-sm md:text-base transition border-b-4 border-blue-300 active:border-b-0 active:translate-y-1">
                å­¸ç¿’
            </button>
            <button onclick="goToScreen('screen-game')" class="nav-btn flex-1 md:flex-none whitespace-nowrap px-4 py-2 rounded-full bg-green-100 hover:bg-green-200 text-green-700 font-bold text-sm md:text-base transition border-b-4 border-green-300 active:border-b-0 active:translate-y-1">
                åˆ†é¡éŠæˆ²
            </button>
            <button onclick="goToScreen('screen-quiz')" class="nav-btn flex-1 md:flex-none whitespace-nowrap px-4 py-2 rounded-full bg-pink-100 hover:bg-pink-200 text-pink-700 font-bold text-sm md:text-base transition border-b-4 border-pink-300 active:border-b-0 active:translate-y-1">
                æ˜¯éæŒ‘æˆ°
            </button>
            <button onclick="goToScreen('screen-lab')" class="nav-btn flex-1 md:flex-none whitespace-nowrap px-4 py-2 rounded-full bg-yellow-100 hover:bg-yellow-200 text-yellow-700 font-bold text-sm md:text-base transition border-b-4 border-yellow-300 active:border-b-0 active:translate-y-1">
                å¯¦é©—å®¤
            </button>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main id="app-container" class="w-full max-w-3xl bg-white rounded-3xl shadow-2xl overflow-hidden min-h-[550px] relative">
        
        <!-- é¦–é  -->
        <div id="screen-home" class="flex flex-col items-center justify-center h-full p-8 text-center space-y-8 absolute inset-0 bg-white z-10 overflow-y-auto">
            <h1 class="text-4xl md:text-5xl font-black text-blue-600 tracking-wider">ç‰©è³ªä¸‰æ…‹<br>åœ¨å“ªè£¡ï¼Ÿ</h1>
            <div class="flex space-x-4 text-6xl">
                <span class="animate-wiggle">ğŸª¨</span>
                <span class="animate-float">ğŸ’§</span>
                <span class="animate-float" style="animation-delay: 0.5s;">ğŸˆ</span>
            </div>
            <p class="text-xl text-gray-600 font-bold">ä¸€èµ·ä¾†èªè­˜å›ºé«”ã€æ¶²é«”å’Œæ°£é«”ï¼</p>
            <button onclick="goToScreen('screen-learn')" class="btn-press bg-green-500 hover:bg-green-600 text-white text-3xl font-bold py-4 px-12 rounded-full shadow-lg transition-colors border-b-8 border-green-700">
                é–‹å§‹å­¸ç¿’
            </button>
        </div>

        <!-- ç¬¬ä¸€é—œï¼šèªè­˜ä¸‰æ…‹ (æ•™å­¸) -->
        <div id="screen-learn" class="hidden flex flex-col h-full bg-blue-50">
            <div class="p-6 text-center bg-blue-100">
                <h2 class="text-3xl font-bold text-blue-800">1. å®ƒå€‘é•·ä»€éº¼æ¨£å­ï¼Ÿ</h2>
            </div>
            <div class="flex-1 p-6 grid grid-cols-1 md:grid-cols-3 gap-4 overflow-y-auto">
                
                <!-- å›ºé«”å¡ç‰‡ -->
                <div class="bg-white p-4 rounded-2xl shadow border-4 border-gray-300 flex flex-col items-center cursor-pointer hover:bg-gray-50 transition" onclick="showParticleDemo('solid')">
                    <div class="text-6xl mb-2">ğŸ§Š</div>
                    <h3 class="text-2xl font-black text-gray-700">å›ºé«”</h3>
                    <p class="text-lg text-gray-500 mt-2 text-center">ç¡¬ç¡¬çš„<br>å½¢ç‹€ä¸æœƒè®Š</p>
                    <div class="mt-4 w-24 h-24 bg-gray-100 rounded border border-gray-300 relative overflow-hidden" id="demo-solid">
                        <!-- JS æœƒå¡«å…¥ç²’å­ -->
                    </div>
                </div>

                <!-- æ¶²é«”å¡ç‰‡ -->
                <div class="bg-white p-4 rounded-2xl shadow border-4 border-blue-300 flex flex-col items-center cursor-pointer hover:bg-blue-50 transition" onclick="showParticleDemo('liquid')">
                    <div class="text-6xl mb-2">ğŸ¥›</div>
                    <h3 class="text-2xl font-black text-blue-600">æ¶²é«”</h3>
                    <p class="text-lg text-gray-500 mt-2 text-center">æœƒæµå‹•<br>æ²’æœ‰å›ºå®šå½¢ç‹€</p>
                    <div class="mt-4 w-24 h-24 bg-blue-50 rounded border border-blue-200 relative overflow-hidden" id="demo-liquid"></div>
                </div>

                <!-- æ°£é«”å¡ç‰‡ -->
                <div class="bg-white p-4 rounded-2xl shadow border-4 border-purple-300 flex flex-col items-center cursor-pointer hover:bg-purple-50 transition" onclick="showParticleDemo('gas')">
                    <div class="text-6xl mb-2">ğŸ’¨</div>
                    <h3 class="text-2xl font-black text-purple-600">æ°£é«”</h3>
                    <p class="text-lg text-gray-500 mt-2 text-center">çœ‹ä¸è¦‹<br>åˆ°è™•äº‚è·‘</p>
                    <div class="mt-4 w-24 h-24 bg-purple-50 rounded border border-purple-200 relative overflow-hidden" id="demo-gas"></div>
                </div>
            </div>
            <div class="p-4 flex justify-center">
                <button onclick="goToScreen('screen-game')" class="btn-press bg-orange-500 text-white text-2xl font-bold py-3 px-10 rounded-full shadow border-b-4 border-orange-700">
                    å»ç©åˆ†é¡éŠæˆ²
                </button>
            </div>
        </div>

        <!-- ç¬¬äºŒé—œï¼šåˆ†é¡éŠæˆ² -->
        <div id="screen-game" class="hidden flex flex-col h-full bg-green-50">
            <div class="p-4 text-center bg-green-100 flex justify-between items-center">
                <div></div> <!-- Spacer -->
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-green-800">2. é€™æ˜¯å“ªä¸€ç¨®ï¼Ÿ</h2>
                    <p class="text-gray-600 text-lg">ç¬¬ <span id="q-num">1</span>/100 é¡Œ</p>
                </div>
                <button onclick="resetGame()" class="bg-gray-200 text-gray-600 px-3 py-1 rounded-lg text-sm font-bold">é‡ä¾†</button>
            </div>
            
            <div class="flex-1 flex flex-col items-center justify-center relative p-4">
                <!-- å•é¡Œå€ -->
                <div id="quiz-card" class="bg-white p-8 rounded-3xl shadow-xl border-4 border-green-200 text-center w-full max-w-xs aspect-square flex flex-col items-center justify-center mb-4 transition-all duration-300 transform">
                    <div id="quiz-icon" class="text-8xl mb-4">ğŸ</div>
                    <div id="quiz-name" class="text-3xl font-bold text-gray-800">è˜‹æœ</div>
                </div>

                <!-- å›é¥‹é®ç½© (å…±ç”¨) -->
                <div id="feedback-overlay" class="absolute inset-0 bg-white/90 flex flex-col items-center justify-center z-20 hidden rounded-3xl">
                    <div id="feedback-icon" class="text-9xl mb-4 animate-bounce">âœ”</div>
                    <div id="feedback-text" class="text-4xl font-black text-green-600">ç­”å°äº†ï¼</div>
                </div>
            </div>

            <!-- é¸é …æŒ‰éˆ• -->
            <div class="p-4 grid grid-cols-3 gap-2 md:gap-4">
                <button onclick="checkAnswer('solid')" class="btn-press bg-gray-200 hover:bg-gray-300 text-gray-700 text-lg md:text-2xl font-bold py-4 rounded-xl border-b-4 border-gray-400">
                    ğŸ§Š å›ºé«”
                </button>
                <button onclick="checkAnswer('liquid')" class="btn-press bg-blue-200 hover:bg-blue-300 text-blue-700 text-lg md:text-2xl font-bold py-4 rounded-xl border-b-4 border-blue-400">
                    ğŸ’§ æ¶²é«”
                </button>
                <button onclick="checkAnswer('gas')" class="btn-press bg-purple-200 hover:bg-purple-300 text-purple-700 text-lg md:text-2xl font-bold py-4 rounded-xl border-b-4 border-purple-400">
                    ğŸ’¨ æ°£é«”
                </button>
            </div>
        </div>

        <!-- æ–°å¢é—œå¡ï¼šæ˜¯éå¤§æŒ‘æˆ° -->
        <div id="screen-quiz" class="hidden flex flex-col h-full bg-pink-50">
            <div class="p-4 text-center bg-pink-100 flex justify-between items-center">
                <div></div>
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-pink-800">æ˜¯éå¤§æŒ‘æˆ°</h2>
                    <p class="text-gray-600 text-lg">ç¬¬ <span id="tf-num">1</span> é¡Œ</p>
                </div>
                <button onclick="resetTFGame()" class="bg-gray-200 text-gray-600 px-3 py-1 rounded-lg text-sm font-bold">é‡ä¾†</button>
            </div>

            <div class="flex-1 flex flex-col items-center justify-center relative p-4">
                <!-- å•é¡Œå€ -->
                <div class="bg-white p-6 rounded-3xl shadow-xl border-4 border-pink-200 text-center w-full max-w-md h-64 flex flex-col items-center justify-center mb-6">
                    <div id="tf-icon" class="text-7xl mb-4">ğŸ§Š</div>
                    <div id="tf-question" class="text-3xl md:text-4xl font-black text-gray-800 leading-tight">
                        å›ºé«”æœ‰å›ºå®šå½¢ç‹€å—ï¼Ÿ
                    </div>
                </div>

                <!-- å›é¥‹é®ç½© (ç¨ç«‹) -->
                <div id="tf-feedback-overlay" class="absolute inset-0 bg-white/95 flex flex-col items-center justify-center z-20 hidden rounded-3xl">
                    <div id="tf-feedback-icon" class="text-9xl mb-4 animate-bounce">âœ”</div>
                    <div id="tf-feedback-text" class="text-4xl font-black text-green-600">ç­”å°äº†ï¼</div>
                </div>
            </div>

            <!-- æ˜¯éæŒ‰éˆ• -->
            <div class="p-6 grid grid-cols-2 gap-6">
                <button onclick="checkTFAnswer(true)" class="btn-press bg-green-100 hover:bg-green-200 text-green-700 text-2xl font-bold py-6 rounded-2xl border-b-8 border-green-300 flex flex-col items-center justify-center gap-2">
                    <span class="text-5xl">âœ”</span>
                    <span>æœ‰ / æ˜¯</span>
                </button>
                <button onclick="checkTFAnswer(false)" class="btn-press bg-red-100 hover:bg-red-200 text-red-700 text-2xl font-bold py-6 rounded-2xl border-b-8 border-red-300 flex flex-col items-center justify-center gap-2">
                    <span class="text-5xl">âœ–</span>
                    <span>æ²’æœ‰ / ä¸æ˜¯</span>
                </button>
            </div>
        </div>

        <!-- ç¬¬ä¸‰é—œï¼šç‰¹æ€§å¯¦é©—å®¤ -->
        <div id="screen-lab" class="hidden flex flex-col h-full bg-yellow-50">
            <div class="p-4 text-center bg-yellow-100">
                <h2 class="text-3xl font-bold text-yellow-800">3. æŠŠå®ƒå€‘è£é€²ç›’å­è£¡</h2>
                <p class="text-gray-600 text-lg">é»æ“Šä¸‹é¢çš„ç‰©è³ªï¼Œçœ‹çœ‹æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</p>
            </div>

            <div class="flex-1 flex flex-col md:flex-row p-4 gap-4 overflow-y-auto">
                <!-- å¯¦é©—å€ -->
                <div class="flex-1 bg-white rounded-2xl border-4 border-gray-200 p-4 relative flex items-center justify-center min-h-[250px]">
                    <!-- å®¹å™¨ -->
                    <div class="w-40 h-40 border-b-8 border-l-8 border-r-8 border-gray-800 relative rounded-b-lg overflow-hidden flex items-end justify-center">
                        <div id="lab-display" class="w-full transition-all duration-1000 flex items-center justify-center">
                            <!-- å‹•ç•«å…§å®¹æœƒåœ¨é€™è£¡ -->
                            <span class="text-gray-400 font-bold">è«‹é¸æ“‡ç‰©è³ª</span>
                        </div>
                    </div>
                </div>

                <!-- æ§åˆ¶èˆ‡èªªæ˜å€ -->
                <div class="flex-1 flex flex-col justify-center space-y-3">
                    <div id="lab-info" class="bg-white p-4 rounded-xl shadow border-2 border-orange-100 min-h-[120px] flex items-center justify-center text-center">
                        <p class="text-2xl font-bold text-gray-500">é»é¸ä¸‹é¢æŒ‰éˆ•<br>é–‹å§‹å¯¦é©—</p>
                    </div>

                    <div class="grid grid-cols-3 gap-2 mt-4">
                        <button onclick="runExperiment('solid')" class="bg-gray-100 p-2 rounded-lg border-2 border-gray-300 hover:bg-gray-200 active:scale-95 transition">
                            <span class="text-3xl block">ğŸ€</span>
                            <span class="font-bold text-gray-700">ç±ƒçƒ</span>
                        </button>
                        <button onclick="runExperiment('liquid')" class="bg-blue-100 p-2 rounded-lg border-2 border-blue-300 hover:bg-blue-200 active:scale-95 transition">
                            <span class="text-3xl block">ğŸ§ƒ</span>
                            <span class="font-bold text-blue-700">æœæ±</span>
                        </button>
                        <button onclick="runExperiment('gas')" class="bg-purple-100 p-2 rounded-lg border-2 border-purple-300 hover:bg-purple-200 active:scale-95 transition">
                            <span class="text-3xl block">ğŸˆ</span>
                            <span class="font-bold text-purple-700">ç©ºæ°£</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµæŸç•«é¢ -->
        <div id="screen-end" class="hidden flex flex-col items-center justify-center h-full p-8 text-center bg-yellow-100 absolute inset-0 z-10">
            <div class="text-9xl mb-6 animate-bounce">ğŸ†</div>
            <h1 class="text-5xl font-black text-red-500 mb-4">å¥½æ£’ï¼</h1>
            <p class="text-2xl text-gray-700 font-bold mb-8">ä½ å®Œæˆäº†æ‰€æœ‰é¡Œç›®ï¼</p>
            <div class="flex gap-4">
                <button onclick="resetApp()" class="btn-press bg-blue-500 hover:bg-blue-600 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-lg border-b-8 border-blue-700">
                    å›åˆ°é¦–é 
                </button>
            </div>
        </div>

    </main>

    <script>
        // --- éŸ³æ•ˆè¨­å®š (Tone.js) ---
        let synth;
        let audioInitialized = false;

        async function initAudio() {
            if (audioInitialized) return;
            try {
                await Tone.start();
                synth = new Tone.PolySynth(Tone.Synth).toDestination();
                synth.set({
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 1 },
                    volume: -5
                });
                audioInitialized = true;
                console.log("Audio Context Started");
            } catch (e) {
                console.error("Audio init failed:", e);
            }
        }

        function playNote(note) {
            if (!audioInitialized) {
                initAudio().then(() => { if (synth) synth.triggerAttackRelease(note, "8n"); });
                return;
            }
            if (synth) synth.triggerAttackRelease(note, "8n");
        }

        // --- 100é¡Œé¡Œåº« (åˆ†é¡éŠæˆ²) ---
        const questions = [
            // å›ºé«”
            { name: "æ›¸æœ¬", icon: "ğŸ“•", type: "solid" }, { name: "çŸ³é ­", icon: "ğŸª¨", type: "solid" },
            { name: "æ¤…å­", icon: "ğŸª‘", type: "solid" }, { name: "è˜‹æœ", icon: "ğŸ", type: "solid" },
            { name: "é‰›ç­†", icon: "âœï¸", type: "solid" }, { name: "è»Šå­", icon: "ğŸš—", type: "solid" },
            { name: "é‹å­", icon: "ğŸ‘Ÿ", type: "solid" }, { name: "å†°å¡Š", icon: "ğŸ§Š", type: "solid" },
            { name: "æ‰‹æ©Ÿ", icon: "ğŸ“±", type: "solid" }, { name: "éºµåŒ…", icon: "ğŸ", type: "solid" },
            { name: "æ¡Œå­", icon: "ğŸªµ", type: "solid" }, { name: "æ¯å­", icon: "â˜•", type: "solid" },
            { name: "é‘°åŒ™", icon: "ğŸ”‘", type: "solid" }, { name: "æ¹¯åŒ™", icon: "ğŸ¥„", type: "solid" },
            { name: "èŠ±", icon: "ğŸŒ¸", type: "solid" }, { name: "æ¨¹æœ¨", icon: "ğŸŒ³", type: "solid" },
            { name: "å¸½å­", icon: "ğŸ§¢", type: "solid" }, { name: "ç±ƒçƒ", icon: "ğŸ€", type: "solid" },
            { name: "ç©æœ¨", icon: "ğŸ§±", type: "solid" }, { name: "é›»è…¦", icon: "ğŸ’»", type: "solid" },
            { name: "è…³è¸è»Š", icon: "ğŸš²", type: "solid" }, { name: "é›»è¦–", icon: "ğŸ“º", type: "solid" },
            { name: "æ™‚é˜", icon: "â°", type: "solid" }, { name: "åºŠ", icon: "ğŸ›ï¸", type: "solid" },
            { name: "è¤²å­", icon: "ğŸ‘–", type: "solid" }, { name: "è¥ªå­", icon: "ğŸ§¦", type: "solid" },
            { name: "çœ¼é¡", icon: "ğŸ‘“", type: "solid" }, { name: "ç‰™åˆ·", icon: "ğŸª¥", type: "solid" },
            { name: "å‰ªåˆ€", icon: "âœ‚ï¸", type: "solid" }, { name: "é›¨å‚˜", icon: "â˜‚ï¸", type: "solid" },
            { name: "å‰ä»–", icon: "ğŸ¸", type: "solid" }, { name: "å…¬è»Š", icon: "ğŸšŒ", type: "solid" },
            { name: "é£›æ©Ÿ", icon: "âœˆï¸", type: "solid" }, { name: "èŠ±ç›†", icon: "ğŸª´", type: "solid" },
            { name: "ç›¤å­", icon: "ğŸ½ï¸", type: "solid" }, { name: "æ›¸åŒ…", icon: "ğŸ’", type: "solid" },
            { name: "ç®±å­", icon: "ğŸ“¦", type: "solid" },
            // æ¶²é«”
            { name: "ç‰›å¥¶", icon: "ğŸ¥›", type: "liquid" }, { name: "æœæ±", icon: "ğŸ§ƒ", type: "liquid" },
            { name: "æ°´", icon: "ğŸ’§", type: "liquid" }, { name: "æ¹¯", icon: "ğŸ²", type: "liquid" },
            { name: "å¯æ¨‚", icon: "ğŸ¥¤", type: "liquid" }, { name: "æ²¹", icon: "ğŸ›¢ï¸", type: "liquid" },
            { name: "é›¨æ°´", icon: "ğŸŒ§ï¸", type: "liquid" }, { name: "èŒ¶", icon: "ğŸµ", type: "liquid" },
            { name: "å’–å•¡", icon: "â˜•", type: "liquid" }, { name: "é†¬æ²¹", icon: "ğŸ¶", type: "liquid" },
            { name: "æ´—é«®ç²¾", icon: "ğŸ§´", type: "liquid" }, { name: "èœ‚èœœ", icon: "ğŸ¯", type: "liquid" },
            { name: "æ³³æ± çš„æ°´", icon: "ğŸŠ", type: "liquid" }, { name: "æµ·æ°´", icon: "ğŸŒŠ", type: "liquid" },
            { name: "çœ¼æ·š", icon: "ğŸ˜¢", type: "liquid" }, { name: "æ²¹æ¼†", icon: "ğŸ¨", type: "liquid" },
            { name: "è¡€", icon: "ğŸ©¸", type: "liquid" }, { name: "æ±—æ°´", icon: "ğŸ˜“", type: "liquid" },
            { name: "å£æ°´", icon: "ğŸ¤¤", type: "liquid" }, { name: "é¦™æ°´", icon: "ğŸ§´", type: "liquid" },
            { name: "å¢¨æ°´", icon: "âœ’ï¸", type: "liquid" }, { name: "æª¸æª¬æ°´", icon: "ğŸ‹", type: "liquid" },
            { name: "é…’", icon: "ğŸ·", type: "liquid" }, { name: "å•¤é…’", icon: "ğŸº", type: "liquid" },
            { name: "è—¥æ°´", icon: "ğŸ§ª", type: "liquid" }, { name: "é†‹", icon: "ğŸ§‚", type: "liquid" },
            { name: "æ²³æ°´", icon: "ğŸï¸", type: "liquid" }, { name: "ä¹³æ¶²", icon: "ğŸ§´", type: "liquid" },
            { name: "æ´—æ‰‹ä¹³", icon: "ğŸ§¼", type: "liquid" }, { name: "çç å¥¶èŒ¶", icon: "ğŸ§‹", type: "liquid" },
            { name: "ç€‘å¸ƒ", icon: "â›²", type: "liquid" }, { name: "æ± å¡˜æ°´", icon: "ğŸ¸", type: "liquid" },
            // æ°£é«”
            { name: "ç†±æ°£", icon: "â™¨ï¸", type: "gas" }, { name: "æ°£çƒè£¡çš„æ°£", icon: "ğŸˆ", type: "gas" },
            { name: "é¢¨", icon: "ğŸŒ¬ï¸", type: "gas" }, { name: "ç…™", icon: "ğŸŒ«ï¸", type: "gas" },
            { name: "é›²", icon: "â˜ï¸", type: "gas" }, { name: "æ°´è’¸æ°£", icon: "ğŸ§–", type: "gas" },
            { name: "å±", icon: "ğŸ’¨", type: "gas" }, { name: "å‘¼å¸çš„æ°£", icon: "ğŸ˜¤", type: "gas" },
            { name: "è¼ªèƒè£¡çš„æ°£", icon: "ğŸ©", type: "gas" }, { name: "ç…®é£¯çš„è’¸æ°£", icon: "ğŸš", type: "gas" },
            { name: "å·¥å» å»¢æ°£", icon: "ğŸ­", type: "gas" }, { name: "å™´éœ§", icon: "ğŸ§´", type: "gas" },
            { name: "æ°§æ°£", icon: "ğŸ«", type: "gas" }, { name: "ç“¦æ–¯", icon: "ğŸ”¥", type: "gas" },
            { name: "æ±½è»Šå»¢æ°£", icon: "ğŸš™", type: "gas" }, { name: "éœ§", icon: "ğŸŒ«ï¸", type: "gas" },
            { name: "é¦™å‘³", icon: "ğŸ‘ƒ", type: "gas" }, { name: "è‡­å‘³", icon: "ğŸ¦¨", type: "gas" },
            { name: "å†·æ°£", icon: "â„ï¸", type: "gas" }, { name: "æš–æ°£", icon: "ğŸŒ¡ï¸", type: "gas" },
            { name: "æ‰“å—", icon: "ğŸ—£ï¸", type: "gas" }, { name: "æ³¡æ³¡è£¡çš„æ°£", icon: "ğŸ«§", type: "gas" },
            { name: "é¾æ²é¢¨", icon: "ğŸŒªï¸", type: "gas" }, { name: "é¢±é¢¨", icon: "ğŸŒ€", type: "gas" },
            { name: "æ±½æ°´æ°£æ³¡", icon: "ğŸ¥¤", type: "gas" }, { name: "å®šå‹å™´éœ§", icon: "ğŸ’ˆ", type: "gas" },
            { name: "æ‰“å™´åš", icon: "ğŸ¤§", type: "gas" }, { name: "å¹å“¨å­çš„æ°£", icon: "ğŸ˜—", type: "gas" },
            { name: "é›»é¢¨æ‰‡çš„é¢¨", icon: "ğŸŒ¬ï¸", type: "gas" }, { name: "æ®ºèŸ²åŠ‘å™´éœ§", icon: "ğŸ¦Ÿ", type: "gas" },
            { name: "æ»…ç«å™¨å™´éœ§", icon: "ğŸ§¯", type: "gas" }
        ];

        // --- æ˜¯éé¡Œé¡Œåº« (æ–°éŠæˆ²) ---
        const tfQuestions = [
            // å›ºé«” (Solid)
            { icon: "ğŸ§Š", text: "å›ºé«”æœ‰å›ºå®šå½¢ç‹€å—ï¼Ÿ", answer: true },
            { icon: "ğŸ§Š", text: "å›ºé«”æœ‰å›ºå®šé«”ç©å—ï¼Ÿ", answer: true },
            { icon: "ğŸ§Š", text: "å›ºé«”æœ‰é‡é‡å—ï¼Ÿ", answer: true },
            // æ¶²é«” (Liquid)
            { icon: "ğŸ¥›", text: "æ¶²é«”æœ‰å›ºå®šå½¢ç‹€å—ï¼Ÿ", answer: false },
            { icon: "ğŸ¥›", text: "æ¶²é«”æœ‰å›ºå®šé«”ç©å—ï¼Ÿ", answer: true },
            { icon: "ğŸ¥›", text: "æ¶²é«”æœ‰é‡é‡å—ï¼Ÿ", answer: true },
            // æ°£é«” (Gas)
            { icon: "ğŸ’¨", text: "æ°£é«”æœ‰å›ºå®šå½¢ç‹€å—ï¼Ÿ", answer: false },
            { icon: "ğŸ’¨", text: "æ°£é«”æœ‰å›ºå®šé«”ç©å—ï¼Ÿ", answer: false },
            { icon: "ğŸ’¨", text: "æ°£é«”æœ‰é‡é‡å—ï¼Ÿ", answer: true },
        ];

        // --- é€šç”¨é‚è¼¯ ---
        let currentQuestionIndex = 0;
        let currentTFIndex = 0;

        function goToScreen(screenId) {
            initAudio();
            document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('ring-2', 'ring-offset-2', 'ring-blue-500'));
            
            if(screenId === 'screen-home') document.querySelector('button[onclick="goToScreen(\'screen-home\')"]').classList.add('ring-2', 'ring-offset-2', 'ring-blue-500');
            else if(screenId === 'screen-learn') {
                document.querySelector('button[onclick="goToScreen(\'screen-learn\')"]').classList.add('ring-2', 'ring-offset-2', 'ring-blue-500');
                initParticles();
            }
            else if(screenId === 'screen-game') {
                document.querySelector('button[onclick="goToScreen(\'screen-game\')"]').classList.add('ring-2', 'ring-offset-2', 'ring-blue-500');
                if(currentQuestionIndex === 0) loadNextQuestion();
            }
            else if(screenId === 'screen-quiz') {
                document.querySelector('button[onclick="goToScreen(\'screen-quiz\')"]').classList.add('ring-2', 'ring-offset-2', 'ring-blue-500');
                loadNextTFQuestion();
            }
            else if(screenId === 'screen-lab') document.querySelector('button[onclick="goToScreen(\'screen-lab\')"]').classList.add('ring-2', 'ring-offset-2', 'ring-blue-500');
        }

        function resetApp() {
            resetGame();
            resetTFGame();
            goToScreen('screen-home');
        }

        // --- ç¬¬ä¸€é—œï¼šç²’å­å‹•ç•« ---
        function initParticles() {
            createParticles('demo-solid', 'solid');
            createParticles('demo-liquid', 'liquid');
            createParticles('demo-gas', 'gas');
        }

        function createParticles(containerId, type) {
            const container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = ''; 
            const count = type === 'gas' ? 5 : (type === 'liquid' ? 15 : 25);
            
            for(let i=0; i<count; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                if(type === 'solid') {
                    p.style.backgroundColor = '#4B5563';
                    p.style.left = `${(i % 5) * 15 + 10}px`;
                    p.style.top = `${Math.floor(i / 5) * 15 + 10}px`;
                    p.style.animation = `wiggle 0.5s infinite alternate`;
                } else if (type === 'liquid') {
                    p.style.backgroundColor = '#3B82F6';
                    p.style.left = `${Math.random() * 60 + 10}px`;
                    p.style.top = `${Math.random() * 30 + 40}px`;
                    p.style.transition = 'all 1s ease';
                    setInterval(() => {
                        p.style.left = `${Math.random() * 60 + 10}px`;
                        p.style.top = `${Math.random() * 30 + 40}px`;
                    }, 1000);
                } else {
                    p.style.backgroundColor = '#A855F7';
                    p.style.left = `${Math.random() * 80}px`;
                    p.style.top = `${Math.random() * 80}px`;
                    p.style.transition = 'all 0.5s linear';
                    setInterval(() => {
                        p.style.left = `${Math.random() * 80}px`;
                        p.style.top = `${Math.random() * 80}px`;
                    }, 500);
                }
                container.appendChild(p);
            }
        }

        function showParticleDemo(type) {
            initAudio(); 
            playNote("E5");
        }

        // --- ç¬¬äºŒé—œï¼šåˆ†é¡éŠæˆ² ---
        function loadNextQuestion() {
            if(currentQuestionIndex >= questions.length) {
                goToScreen('screen-end');
                return;
            }
            const q = questions[currentQuestionIndex];
            document.getElementById('quiz-icon').innerText = q.icon;
            document.getElementById('quiz-name').innerText = q.name;
            document.getElementById('q-num').innerText = currentQuestionIndex + 1;
            document.getElementById('feedback-overlay').classList.add('hidden');
        }

        function checkAnswer(userType) {
            const correctType = questions[currentQuestionIndex].type;
            const overlay = document.getElementById('feedback-overlay');
            const icon = document.getElementById('feedback-icon');
            const text = document.getElementById('feedback-text');

            overlay.classList.remove('hidden');

            if(userType === correctType) {
                playNote("G5");
                icon.innerText = "âœ”";
                text.innerText = "å¥½æ£’ï¼";
                text.className = "text-4xl font-black text-green-600";
                setTimeout(() => {
                    currentQuestionIndex++;
                    loadNextQuestion();
                }, 1500);
            } else {
                playNote("C4");
                icon.innerText = "âœ–";
                text.innerText = "å†è©¦ä¸€æ¬¡";
                text.className = "text-4xl font-black text-orange-500";
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 1000);
            }
        }

        function resetGame() {
            currentQuestionIndex = 0;
            questions.sort(() => Math.random() - 0.5);
            loadNextQuestion();
        }

        // --- æ–°é—œå¡ï¼šæ˜¯éå¤§æŒ‘æˆ° (é‚è¼¯) ---
        function loadNextTFQuestion() {
            if(currentTFIndex >= tfQuestions.length) {
                goToScreen('screen-end'); // æˆ–è€…å›åˆ°åˆ—è¡¨
                return;
            }
            const q = tfQuestions[currentTFIndex];
            document.getElementById('tf-icon').innerText = q.icon;
            document.getElementById('tf-question').innerText = q.text;
            document.getElementById('tf-num').innerText = currentTFIndex + 1;
            document.getElementById('tf-feedback-overlay').classList.add('hidden');
        }

        function checkTFAnswer(userAnswer) {
            const correctAnswer = tfQuestions[currentTFIndex].answer;
            const overlay = document.getElementById('tf-feedback-overlay');
            const icon = document.getElementById('tf-feedback-icon');
            const text = document.getElementById('tf-feedback-text');

            overlay.classList.remove('hidden');

            if(userAnswer === correctAnswer) {
                playNote("G5");
                icon.innerText = "âœ”";
                text.innerText = "ç­”å°äº†ï¼";
                text.className = "text-4xl font-black text-green-600";
                setTimeout(() => {
                    currentTFIndex++;
                    loadNextTFQuestion();
                }, 1500);
            } else {
                playNote("C4");
                icon.innerText = "âœ–";
                text.innerText = "å†æƒ³ä¸€æƒ³";
                text.className = "text-4xl font-black text-orange-500";
                setTimeout(() => {
                    overlay.classList.add('hidden');
                }, 1000);
            }
        }

        function resetTFGame() {
            currentTFIndex = 0;
            tfQuestions.sort(() => Math.random() - 0.5);
            loadNextTFQuestion();
        }


        // --- ç¬¬ä¸‰é—œï¼šç‰¹æ€§å¯¦é©—å®¤ ---
        function runExperiment(type) {
            playNote("E4");
            const display = document.getElementById('lab-display');
            const info = document.getElementById('lab-info');
            
            display.innerHTML = '';
            display.style.height = 'auto';
            display.style.width = '100%';

            if (type === 'solid') {
                display.innerHTML = '<div class="text-6xl animate-bounce">ğŸ€</div>';
                display.className = "w-full h-full flex items-center justify-center";
                info.innerHTML = `
                    <div class="text-left">
                        <p class="text-green-600 font-bold text-xl">âœ” å½¢ç‹€å›ºå®š</p>
                        <p class="text-green-600 font-bold text-xl">âœ” é«”ç©å›ºå®š</p>
                        <p class="text-red-500 font-bold text-xl">âœ– ä¸æœƒæµå‹•</p>
                        <p class="text-sm text-gray-500 mt-1">ç±ƒçƒæ˜¯å›ºå®šçš„ï¼Œä¸æœƒè®Šå½¢ã€‚</p>
                    </div>
                `;
            } else if (type === 'liquid') {
                display.innerHTML = '<div class="w-full h-full bg-blue-400 opacity-80" style="border-radius: 0 0 4px 4px;"></div>';
                display.className = "w-full h-20 self-end transition-all duration-1000"; 
                info.innerHTML = `
                    <div class="text-left">
                        <p class="text-red-500 font-bold text-xl">âœ– å½¢ç‹€ä¸å›ºå®š</p>
                        <p class="text-green-600 font-bold text-xl">âœ” é«”ç©å›ºå®š</p>
                        <p class="text-green-600 font-bold text-xl">âœ” æœƒæµå‹•</p>
                        <p class="text-sm text-gray-500 mt-1">æœæ±è®Šæˆæ¯å­çš„å½¢ç‹€äº†ï¼</p>
                    </div>
                `;
            } else if (type === 'gas') {
                display.innerHTML = 'ğŸ’¨ ğŸ’¨ ğŸ’¨';
                display.className = "w-full h-full flex items-center justify-center text-4xl text-gray-400 animate-pulse";
                info.innerHTML = `
                    <div class="text-left">
                        <p class="text-red-500 font-bold text-xl">âœ– å½¢ç‹€ä¸å›ºå®š</p>
                        <p class="text-red-500 font-bold text-xl">âœ– é«”ç©ä¸å›ºå®š</p>
                        <p class="text-green-600 font-bold text-xl">âœ” æœƒæµå‹•</p>
                        <p class="text-sm text-gray-500 mt-1">ç©ºæ°£è·‘æ»¿äº†æ•´å€‹ç©ºé–“ï¼</p>
                    </div>
                `;
            }
        }
        
        // é é¢è¼‰å…¥æ™‚å…ˆéš¨æ©Ÿæ’åºé¡Œç›®
        questions.sort(() => Math.random() - 0.5);
        tfQuestions.sort(() => Math.random() - 0.5);
    </script>
</body>
</html>